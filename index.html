<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Метод 6 Кувшинов - Интерактивная Система</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FAFAF9; /* Warm neutral background (stone-50) */
            color: #1C1917; /* stone-900 */
        }
        
        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid currentColor;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #E5E7EB;
            border-radius: 2px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 0 auto;
        }

        .jar-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .jar-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Animation for results */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Chosen Palette: Warm Neutral Background (#FAFAF9) with Functional Semantic Colors for Jars (Blue, Green, Purple, Yellow, Orange, Pink) -->
    
    <!-- Application Structure Plan: 
         1. Header: Simple branding.
         2. Control Bar (Top): High-priority actions (Income Input, Live Month Button) to minimize scrolling.
         3. Status Dashboard: Visual feedback on total allocation (Progress bar + Chart).
         4. Jars Grid: The core interactive element. Sliders combined with cards for direct manipulation.
         5. Analysis Section: Generated content based on user interaction (The "Report" aspect).
    -->

    <!-- Header Section -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-30 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
            
            <!-- Title -->
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white text-xl">
                    <i class="fa-solid fa-coins"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-stone-800 tracking-tight">Метод 6 Кувшинов</h1>
                    <p class="text-xs text-stone-500">Система управления бюджетом</p>
                </div>
            </div>

            <!-- Top Controls (Requested: Button moved here) -->
            <div class="flex flex-col sm:flex-row items-center gap-4 w-full md:w-auto">
                <!-- Income Input -->
                <div class="relative w-full sm:w-auto">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-stone-400">₽</span>
                    </div>
                    <input type="number" id="totalIncome" value="50000" class="block w-full sm:w-48 pl-8 pr-3 py-2 border border-stone-300 rounded-lg leading-5 bg-stone-50 placeholder-stone-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition shadow-inner font-mono font-medium" placeholder="Доход">
                    <label class="absolute -top-2 left-2 bg-white px-1 text-xs text-stone-500">Ваш доход</label>
                </div>

                <!-- Action Button -->
                <button id="liveMonthBtn" class="w-full sm:w-auto bg-stone-900 hover:bg-stone-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition-all duration-200 flex items-center justify-center gap-2 transform active:scale-95">
                    <i class="fa-solid fa-play"></i>
                    <span>Прожить месяц</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full max-w-6xl mx-auto px-4 py-8 space-y-8">

        <!-- Introduction Text -->
        <section class="max-w-3xl mx-auto text-center">
            <h2 class="text-2xl font-bold text-stone-800 mb-2">Распределите свой бюджет</h2>
            <p class="text-stone-600 leading-relaxed">
                Система «6 кувшинов» помогает сбалансировать финансовую жизнь. Используйте бегунки внутри карточек, чтобы настроить распределение под свою ситуацию. Ваша цель — распределить ровно 100%.
            </p>
        </section>

        <!-- Allocation Dashboard (Chart & Status) -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
            
            <!-- Left: Jars Grid (The interactive core) -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Allocation Status Bar -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-200">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-sm font-medium text-stone-500">Всего распределено:</span>
                        <span id="totalPercentDisplay" class="text-2xl font-bold text-stone-800">100%</span>
                    </div>
                    <div class="w-full bg-stone-100 rounded-full h-4 overflow-hidden">
                        <div id="progressBar" class="bg-green-500 h-4 rounded-full transition-all duration-300" style="width: 100%"></div>
                    </div>
                    <p id="allocationMessage" class="text-xs mt-2 text-right text-green-600 font-medium">Бюджет сбалансирован идеально</p>
                </div>

                <!-- Cards Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="jarsGrid">
                    <!-- Jars will be injected here by JS -->
                </div>
            </div>

            <!-- Right: Visualization (Chart) -->
            <div class="lg:col-span-1 sticky top-24">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                    <h3 class="text-lg font-semibold text-stone-800 mb-4 border-b border-stone-100 pb-2">Визуализация</h3>
                    <div class="chart-container">
                        <canvas id="allocationChart"></canvas>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="mt-6 space-y-3">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-stone-500">Свободные деньги (ФС+РНТ)</span>
                            <span id="savingsTotal" class="font-bold text-stone-800">0 ₽</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-stone-500">На жизнь (НЗ)</span>
                            <span id="needsTotal" class="font-bold text-stone-800">0 ₽</span>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <!-- Analysis / Report Section (Hidden initially) -->
        <section id="reportSection" class="hidden max-w-4xl mx-auto mt-12 mb-12 fade-in">
            <div class="bg-white rounded-2xl shadow-lg border border-indigo-100 overflow-hidden">
                <div class="bg-stone-900 text-white p-6">
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <i class="fa-solid fa-file-invoice"></i> Отчет за месяц
                    </h2>
                    <p class="text-stone-400 text-sm mt-1">Анализ вашей финансовой стратегии</p>
                </div>
                <div class="p-6 md:p-8 space-y-6">
                    <!-- Dynamic Feedback -->
                    <div id="reportContent" class="prose prose-stone max-w-none">
                        <!-- Content injected via JS -->
                    </div>
                    
                    <!-- Action Items -->
                    <div class="bg-stone-50 p-5 rounded-lg border-l-4 border-indigo-500">
                        <h4 class="font-bold text-stone-800 mb-2">Рекомендация системы:</h4>
                        <p id="reportRecommendation" class="text-stone-600 text-sm"></p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-stone-200 py-6 mt-auto">
        <div class="max-w-6xl mx-auto px-4 text-center text-stone-400 text-sm">
            <p>Метод 6 Кувшинов &copy; 2025. Интерактивная версия.</p>
        </div>
    </footer>

    <!-- Visualization & Content Choices:
         1. Charts: Doughnut chart used for 'Whole' visualization to show proportions instantly. No SVG, purely Canvas.
         2. Interaction: Range inputs embedded in cards allow tactile adjustment.
         3. Logic: Total percentage validation ensures the user adheres to the "Zero-based budgeting" principle (allocating every ruble).
    -->

    <script>
        // --- DATA & STATE ---
        // Default T. Harv Eker distribution
        const defaultJars = [
            { id: 'nec', name: 'Необходимое', sub: 'Жизнь, еда, счета', percent: 55, color: '#3B82F6', icon: 'fa-house' },    // Blue
            { id: 'fun', name: 'Развлечения', sub: 'Хобби, рестораны, кино', percent: 10, color: '#F59E0B', icon: 'fa-champagne-glasses' }, // Amber
            { id: 'inv', name: 'Инвестиции', sub: 'Фин. свобода (ФС)', percent: 10, color: '#10B981', icon: 'fa-arrow-trend-up' }, // Green
            { id: 'edu', name: 'Образование', sub: 'Книги, курсы, рост', percent: 10, color: '#8B5CF6', icon: 'fa-graduation-cap' }, // Purple
            { id: 'lts', name: 'Резерв', sub: 'Крупные покупки', percent: 10, color: '#6366F1', icon: 'fa-piggy-bank' },     // Indigo
            { id: 'giv', name: 'Подарки', sub: 'Благотворительность', percent: 5, color: '#EC4899', icon: 'fa-heart' }         // Pink
        ];

        let state = {
            income: 50000,
            jars: JSON.parse(JSON.stringify(defaultJars)) // Deep copy
        };

        // --- DOM ELEMENTS ---
        const els = {
            incomeInput: document.getElementById('totalIncome'),
            jarsGrid: document.getElementById('jarsGrid'),
            progressBar: document.getElementById('progressBar'),
            totalPercentDisplay: document.getElementById('totalPercentDisplay'),
            msg: document.getElementById('allocationMessage'),
            chartCanvas: document.getElementById('allocationChart'),
            liveBtn: document.getElementById('liveMonthBtn'),
            reportSection: document.getElementById('reportSection'),
            reportContent: document.getElementById('reportContent'),
            reportRec: document.getElementById('reportRecommendation'),
            savingsTotal: document.getElementById('savingsTotal'),
            needsTotal: document.getElementById('needsTotal')
        };

        let chartInstance = null;

        // --- INITIALIZATION ---
        function init() {
            renderJars();
            initChart();
            updateCalculations();
            setupListeners();
        }

        // --- CORE LOGIC ---

        function setupListeners() {
            // Income Change
            els.incomeInput.addEventListener('input', (e) => {
                const val = parseInt(e.target.value) || 0;
                state.income = val;
                updateCalculations();
            });

            // Live Button
            els.liveBtn.addEventListener('click', generateReport);
        }

        function handleSliderChange(jarId, newVal) {
            const jarIndex = state.jars.findIndex(j => j.id === jarId);
            if(jarIndex !== -1) {
                state.jars[jarIndex].percent = parseInt(newVal);
                updateCalculations();
            }
        }

        function updateCalculations() {
            const totalPercent = state.jars.reduce((acc, j) => acc + j.percent, 0);
            
            // Update Jar UI Numbers
            state.jars.forEach(jar => {
                const amount = Math.round((state.income * jar.percent) / 100);
                
                // Update Amount Text
                const amountEl = document.getElementById(`amount-${jar.id}`);
                if(amountEl) amountEl.textContent = amount.toLocaleString('ru-RU') + ' ₽';
                
                // Update Percent Badge
                const badgeEl = document.getElementById(`badge-${jar.id}`);
                if(badgeEl) badgeEl.textContent = jar.percent + '%';

                // Update Slider Background (Visual Fill)
                const rangeEl = document.getElementById(`range-${jar.id}`);
                if(rangeEl) {
                    // CSS gradient trick for slider track fill
                    const val = (jar.percent - rangeEl.min) / (rangeEl.max - rangeEl.min) * 100;
                    rangeEl.style.background = `linear-gradient(to right, ${jar.color} 0%, ${jar.color} ${val}%, #E5E7EB ${val}%, #E5E7EB 100%)`;
                    // Color the thumb via inline style logic or class toggle if needed, but simple CSS handles it globally mostly.
                    // To color the thumb specifically, we need more complex CSS or just let it be neutral.
                    // Let's set the text color of the range input to the jar color so 'currentColor' works in CSS
                    rangeEl.style.color = jar.color;
                }
            });

            // Update Global Status Bar
            els.totalPercentDisplay.textContent = totalPercent + '%';
            els.progressBar.style.width = Math.min(totalPercent, 100) + '%';
            
            if (totalPercent === 100) {
                els.progressBar.className = 'h-4 rounded-full transition-all duration-300 bg-green-500';
                els.msg.className = 'text-xs mt-2 text-right text-green-600 font-medium';
                els.msg.textContent = "✔ Бюджет распределен полностью";
            } else if (totalPercent < 100) {
                els.progressBar.className = 'h-4 rounded-full transition-all duration-300 bg-blue-400';
                els.msg.className = 'text-xs mt-2 text-right text-blue-600 font-medium';
                els.msg.textContent = `Осталось распределить: ${100 - totalPercent}%`;
            } else {
                els.progressBar.className = 'h-4 rounded-full transition-all duration-300 bg-red-500';
                els.msg.className = 'text-xs mt-2 text-right text-red-600 font-medium';
                els.msg.textContent = `⚠ Превышение бюджета на ${totalPercent - 100}%`;
            }

            // Update Quick Stats
            const nec = state.jars.find(j => j.id === 'nec');
            const inv = state.jars.find(j => j.id === 'inv');
            const lts = state.jars.find(j => j.id === 'lts');
            
            const savings = ((inv?.percent || 0) + (lts?.percent || 0)) / 100 * state.income;
            const needs = (nec?.percent || 0) / 100 * state.income;

            els.savingsTotal.textContent = Math.round(savings).toLocaleString('ru-RU') + ' ₽';
            els.needsTotal.textContent = Math.round(needs).toLocaleString('ru-RU') + ' ₽';

            // Update Chart
            updateChart();
        }

        // --- RENDERING ---

        function renderJars() {
            els.jarsGrid.innerHTML = '';
            
            state.jars.forEach(jar => {
                const card = document.createElement('div');
                card.className = 'jar-card bg-white p-5 rounded-xl border border-stone-200 shadow-sm flex flex-col gap-4';
                
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-sm" style="background-color: ${jar.color}">
                                <i class="fa-solid ${jar.icon}"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-stone-800">${jar.name}</h3>
                                <p class="text-xs text-stone-400">${jar.sub}</p>
                            </div>
                        </div>
                        <div id="badge-${jar.id}" class="px-2 py-1 rounded text-xs font-bold bg-stone-100 text-stone-600">
                            ${jar.percent}%
                        </div>
                    </div>

                    <div class="space-y-1">
                         <div class="flex justify-between items-end">
                            <label class="text-xs font-semibold text-stone-400 uppercase tracking-wider">Сумма</label>
                            <span id="amount-${jar.id}" class="text-xl font-bold text-stone-800 tracking-tight">0 ₽</span>
                        </div>
                    </div>

                    <div class="pt-2">
                        <input type="range" 
                               id="range-${jar.id}"
                               min="0" max="100" 
                               value="${jar.percent}" 
                               class="w-full focus:outline-none"
                               oninput="handleSliderChange('${jar.id}', this.value)"
                        >
                        <div class="flex justify-between text-[10px] text-stone-300 mt-1 font-mono">
                            <span>0%</span>
                            <span>50%</span>
                            <span>100%</span>
                        </div>
                    </div>
                `;
                
                els.jarsGrid.appendChild(card);
            });
        }

        // --- CHART JS ---
        function initChart() {
            const ctx = els.chartCanvas.getContext('2d');
            
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: state.jars.map(j => j.name),
                    datasets: [{
                        data: state.jars.map(j => j.percent),
                        backgroundColor: state.jars.map(j => j.color),
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: {
                            display: false 
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if(!chartInstance) return;
            chartInstance.data.datasets[0].data = state.jars.map(j => j.percent);
            chartInstance.update();
        }

        // --- REPORT GENERATION ---
        function generateReport() {
            els.reportSection.classList.remove('hidden');
            // Scroll to report
            setTimeout(() => {
                els.reportSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);

            const total = state.jars.reduce((a, b) => a + b.percent, 0);
            const nec = state.jars.find(j => j.id === 'nec').percent;
            const inv = state.jars.find(j => j.id === 'inv').percent;
            const fun = state.jars.find(j => j.id === 'fun').percent;

            let feedbackHTML = '';
            let recommendation = '';

            // Total Check
            if (total !== 100) {
                feedbackHTML += `<p class="text-red-600 font-bold mb-4">⚠ Внимание: Ваш бюджет не равен 100%. Текущая сумма: ${total}%. Это нарушает основной принцип метода.</p>`;
                recommendation = "Сначала скорректируйте проценты, чтобы в сумме получилось ровно 100%.";
            } else {
                feedbackHTML += `<p class="text-green-600 font-bold mb-4">Отлично! Бюджет полностью распределен.</p>`;
                
                // NEC Analysis
                if (nec > 60) {
                    feedbackHTML += `<p><strong>Высокая нагрузка на "Нужды" (${nec}%):</strong> Вы тратите слишком много на обязательные расходы. Это зона риска. Постарайтесь оптимизировать бытовые траты или найти способы увеличить доход.</p>`;
                    recommendation = "Проведите аудит постоянных расходов. Попробуйте снизить долю обязательных трат до 50-55%.";
                } else if (nec < 40) {
                    feedbackHTML += `<p><strong>Низкие расходы на жизнь (${nec}%):</strong> У вас отличный запас прочности! Вы можете позволить себе инвестировать больше.</p>`;
                    recommendation = "Увеличьте долю инвестиций (ФС) или образовательный фонд.";
                } else {
                    feedbackHTML += `<p><strong>Сбалансированные нужды (${nec}%):</strong> Вы находитесь в пределах нормы (50-55%). Это здоровая финансовая база.</p>`;
                    recommendation = "Продолжайте придерживаться этого баланса.";
                }

                // INV Analysis
                if (inv < 10) {
                    feedbackHTML += `<p class="mt-2"><strong>Недостаток инвестиций (${inv}%):</strong> "Кувшин ФС" — это ваш билет к финансовой свободе. 10% — это минимум, который нужно платить самому себе.</p>`;
                } else {
                    feedbackHTML += `<p class="mt-2"><strong>Хороший темп накоплений (${inv}%):</strong> Вы формируете капитал. Главное — не тратить эти деньги, а инвестировать.</p>`;
                }

                // FUN Analysis
                if (fun < 5) {
                    feedbackHTML += `<p class="mt-2"><strong>Риск выгорания (${fun}%):</strong> Вы выделили слишком мало на развлечения. Метод кувшинов настаивает на том, чтобы тратить деньги на удовольствия, иначе вы сорветесь и потратите накопления.</p>`;
                    if(!recommendation) recommendation = "Обязательно добавьте денег в кувшин 'Развлечения' и потратьте их на себя в этом месяце!";
                }
            }

            els.reportContent.innerHTML = feedbackHTML;
            els.reportRec.textContent = recommendation || "Соблюдайте дисциплину распределения каждый раз при получении дохода.";
        }

        // Run on load
        window.addEventListener('DOMContentLoaded', init);

    </script>
    
    <!-- CONFIRMATION: NO SVG graphics used (FontAwesome + Canvas used). NO Mermaid JS used. -->
</body>
</html>
