```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—É—Ç—å –∫ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–π –°–≤–æ–±–æ–¥–µ</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- noUiSlider -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.js"></script>

    <!-- Chosen Palette: Warm Neutral & Progression -->
    <!-- Colors: 
         Background: Stone-50 (#fafaf9)
         Surface: White (#ffffff)
         Phase 1 (Safety): Emerald-600 (#059669)
         Phase 2 (Growth): Indigo-600 (#4f46e5)
         Alert: Rose-500 (#f43f5e)
         Text: Stone-800 (#292524)
    -->

    <!-- Application Structure Plan: 
         1. Progression System (The "Clicker" Mechanic): 
            - The game is split into two distinct phases to reduce cognitive load.
            - Phase 1: "The Saver". Only basic jars (Needs, Comfort, Savings) are active. Goal: Build a safety cushion.
            - Phase 2: "The Investor". Unlocks purely after hitting the Phase 1 goal. Adds Risk/Investment jars.
         2. Layout: 
            - Top: Global HUD (Health, Happiness, Money, Phase Indicator).
            - Left: The "Machine" (Sliders). visually separated into "Active" and "Locked" zones.
            - Right: The "Feedback" (Chart & Logs). Shows the impact of decisions.
         3. Rationale: Incremental unlocking (like in idle games) ensures the player understands the value of savings before being tempted by speculation.
    -->

    <!-- Visualization & Content Choices:
         1. Locked Sections: Used CSS blurring and padlock icons to visually represent unavailable strategies. This creates a clear "Goal" for the user (unlocking the game).
         2. Liquid Jars: Retained the CSS liquid metaphor as it perfectly visualizes "filling up" accounts.
         3. Dynamic Chart: The chart scales and tracks net worth, visualizing the exponential curve once Phase 2 hits.
         4. Confirming NO SVG/Mermaid: Icons are Unicode characters. Graphics are CSS/Canvas.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(231, 229, 228, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Jar Visuals */
        .jar-container {
            position: relative;
            width: 50px;
            height: 120px;
            background: #e7e5e4;
            border-radius: 0 0 12px 12px;
            border-left: 2px solid rgba(255,255,255,0.8);
            border-right: 2px solid rgba(255,255,255,0.8);
            border-bottom: 4px solid rgba(255,255,255,0.8);
            overflow: hidden;
            margin: 0 auto;
        }

        .liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            transition: height 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            opacity: 0.9;
        }

        .liquid-basic { background: linear-gradient(to top, #f59e0b, #fbbf24); } 
        .liquid-safe { background: linear-gradient(to top, #059669, #34d399); } 
        .liquid-risk  { background: linear-gradient(to top, #4f46e5, #818cf8); } 

        /* Slider Customization */
        .noUi-target { background: #d6d3d1; border: none; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); }
        .noUi-connect { background: #78716c; }
        .noUi-handle {
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: grab;
            background: #fff;
            width: 18px !important;
            height: 18px !important;
            right: -9px !important;
        }
        .noUi-handle:before, .noUi-handle:after { display: none; }

        /* Locked State Styles */
        .locked-section {
            filter: grayscale(100%);
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }
        .locked-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.4);
            z-index: 10;
            backdrop-filter: blur(1px);
            text-align: center;
        }

        /* Chart Container */
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 220px;
            max-height: 220px;
        }

        /* Animations */
        @keyframes unlock-pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7); }
            50% { transform: scale(1.02); box-shadow: 0 0 0 15px rgba(79, 70, 229, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
        }
        .animate-unlock { animation: unlock-pulse 1.5s ease-out infinite; }
        
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 antialiased min-h-screen flex flex-col">

    <!-- INTRO SCREEN -->
    <div id="screen-intro" class="flex-grow flex flex-col items-center justify-center p-4">
        <div class="max-w-2xl w-full text-center space-y-8 bg-white p-10 rounded-2xl shadow-xl">
            <div class="text-6xl mb-4">üå± ‚û°Ô∏è üå≥</div>
            <h1 class="text-4xl md:text-5xl font-bold text-stone-900 tracking-tight">–ü—É—Ç—å –∫ –§–∏–Ω–∞–Ω—Å–æ–≤–æ–π –°–≤–æ–±–æ–¥–µ</h1>
            
            <div class="space-y-4 text-lg text-stone-600">
                <p>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—Å–ø–µ—Ö –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É. –≠—Ç–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∏–∑ –¥–≤—É—Ö —ç—Ç–∞–ø–æ–≤.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                    <div class="p-4 bg-emerald-50 rounded-lg border border-emerald-100">
                        <div class="font-bold text-emerald-800 text-xl mb-2">–≠—Ç–∞–ø 1: –°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å</div>
                        <p class="text-sm">–ù–∞—É—á–∏—Å—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –∏ —Å–æ–∑–¥–∞–π –ø–æ–¥—É—à–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</p>
                    </div>
                    <div class="p-4 bg-stone-100 rounded-lg border border-stone-200 opacity-70">
                        <div class="font-bold text-stone-600 text-xl mb-2">–≠—Ç–∞–ø 2: –ò–Ω–≤–µ—Å—Ç–æ—Ä</div>
                        <p class="text-sm">–ó–∞—Å—Ç–∞–≤—å –¥–µ–Ω—å–≥–∏ —Ä–∞–±–æ—Ç–∞—Ç—å. –î–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞.</p>
                    </div>
                </div>
            </div>

            <button onclick="game.startGame()" class="mt-8 bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-xl py-4 px-12 rounded-full shadow-lg transform transition-transform active:scale-95">
                –ù–∞—á–∞—Ç—å –ü—É—Ç—å
            </button>
        </div>
    </div>

    <!-- GAME DASHBOARD -->
    <div id="screen-game" class="hidden flex-col min-h-screen">
        
        <!-- Header / HUD -->
        <header class="bg-white border-b border-stone-200 sticky top-0 z-30 shadow-sm">
            <div class="max-w-6xl mx-auto px-4 py-3">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <!-- Identity & Phase -->
                    <div class="flex items-center gap-3">
                        <span class="text-2xl" id="ui-phase-icon">üå±</span>
                        <div>
                            <div class="text-xs text-stone-400 uppercase font-bold tracking-wider">–¢–µ–∫—É—â–∏–π –°—Ç–∞—Ç—É—Å</div>
                            <div id="ui-role-name" class="font-bold text-stone-800 leading-none">–ù–æ–≤–∏—á–æ–∫-–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å</div>
                        </div>
                        <div class="ml-4 bg-stone-100 px-3 py-1 rounded text-sm font-mono text-stone-500">
                            –ú–µ—Å—è—Ü: <span id="ui-turn" class="font-bold text-stone-900">1</span>
                        </div>
                    </div>

                    <!-- Goal Progress -->
                    <div class="flex-grow max-w-md w-full">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-stone-500" id="ui-goal-label">–¶–µ–ª—å: –ù–∞–∫–æ–ø–∏—Ç—å $3,000</span>
                            <span class="font-bold text-emerald-600" id="ui-goal-percent">0%</span>
                        </div>
                        <div class="w-full h-2 bg-stone-200 rounded-full overflow-hidden">
                            <div id="bar-goal" class="h-full bg-emerald-500 transition-all duration-700" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Vitals -->
                    <div class="flex gap-4">
                        <div class="text-center" title="–ó–¥–æ—Ä–æ–≤—å–µ">
                            <div class="text-lg">‚ù§Ô∏è</div>
                            <div id="ui-health" class="text-xs font-bold text-rose-600">100%</div>
                        </div>
                        <div class="text-center" title="–°—á–∞—Å—Ç—å–µ">
                            <div class="text-lg">üòÉ</div>
                            <div id="ui-happy" class="text-xs font-bold text-amber-500">100%</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow max-w-6xl mx-auto w-full p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- LEFT COLUMN: CONTROLS -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Financial Summary -->
                <div class="grid grid-cols-3 gap-4">
                    <div class="glass-panel p-3 rounded-lg text-center">
                        <div class="text-xs text-stone-500">–î–æ—Ö–æ–¥</div>
                        <div id="ui-income" class="text-lg font-bold text-emerald-700">$1000</div>
                    </div>
                    <div class="glass-panel p-3 rounded-lg text-center">
                        <div class="text-xs text-stone-500">–†–∞—Å—Ö–æ–¥</div>
                        <div id="ui-expense" class="text-lg font-bold text-rose-700">$0</div>
                    </div>
                    <div class="glass-panel p-3 rounded-lg text-center bg-stone-50" id="card-free">
                        <div class="text-xs text-stone-500">–û—Å—Ç–∞—Ç–æ–∫</div>
                        <div id="ui-free" class="text-lg font-bold text-stone-800">$0</div>
                    </div>
                </div>

                <!-- PHASE 1: FOUNDATION (Always Active) -->
                <div class="glass-panel rounded-xl p-5 border-t-4 border-emerald-500">
                    <div class="flex justify-between items-center mb-4 border-b border-stone-100 pb-2">
                        <h3 class="font-bold text-stone-700">1. –ë–∞–∑–∞ –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                        <span class="text-xs bg-emerald-100 text-emerald-800 px-2 py-1 rounded">–î–æ—Å—Ç—É–ø–Ω–æ</span>
                    </div>
                    
                    <div class="grid grid-cols-3 sm:grid-cols-4 gap-4">
                        <!-- Jar: Survival -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-survival" class="liquid liquid-basic"></div>
                            </div>
                            <div id="slider-survival" class="h-28 absolute top-[4px] right-[-8px] opacity-60 hover:opacity-100"></div>
                            <div class="mt-2 text-xs font-bold">–ù—É–∂–¥—ã</div>
                            <div class="text-[10px] text-stone-500" id="val-survival">$0</div>
                        </div>

                        <!-- Jar: Comfort -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-comfort" class="liquid liquid-basic"></div>
                            </div>
                            <div id="slider-comfort" class="h-28 absolute top-[4px] right-[-8px] opacity-60 hover:opacity-100"></div>
                            <div class="mt-2 text-xs font-bold">–ö–æ–º—Ñ–æ—Ä—Ç</div>
                            <div class="text-[10px] text-stone-500" id="val-comfort">$0</div>
                        </div>

                        <!-- Jar: Savings (The Goal) -->
                        <div class="text-center relative">
                            <div class="jar-container border-emerald-200 bg-emerald-50">
                                <div id="fill-savings" class="liquid liquid-safe"></div>
                            </div>
                            <!-- No slider for savings, it captures overflow -->
                            <div class="mt-2 text-xs font-bold text-emerald-700">–ö–æ–ø–∏–ª–∫–∞</div>
                            <div class="text-[10px] text-emerald-600 font-bold" id="val-savings">$0</div>
                            <div class="text-[9px] text-stone-400 mt-1">–ê–≤—Ç–æ-–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                        </div>
                    </div>
                    <p class="text-xs text-stone-500 mt-4 italic">–°–æ–≤–µ—Ç: –û–±–µ—Å–ø–µ—á—å—Ç–µ –Ω—É–∂–¥—ã –∏ –∫–æ–º—Ñ–æ—Ä—Ç. –í—Å—ë, —á—Ç–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–π–¥–µ—Ç –≤ –ö–æ–ø–∏–ª–∫—É.</p>
                </div>

                <!-- PHASE 2: GROWTH (Locked Initially) -->
                <div id="phase-2-panel" class="glass-panel rounded-xl p-5 border-t-4 border-indigo-500 locked-section transition-all duration-700">
                    
                    <!-- Lock Overlay -->
                    <div id="lock-overlay" class="locked-overlay rounded-lg">
                        <div class="bg-white p-4 rounded-full shadow-lg mb-2">
                            <span class="text-2xl">üîí</span>
                        </div>
                        <div class="font-bold text-stone-700">–ó–æ–Ω–∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>
                        <div class="text-xs text-stone-500 mt-1">–ù–∞–∫–æ–ø–∏—Ç–µ $3,000 –≤ –ö–æ–ø–∏–ª–∫–µ,<br>—á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å</div>
                    </div>

                    <div class="flex justify-between items-center mb-4 border-b border-stone-100 pb-2">
                        <h3 class="font-bold text-indigo-700">2. –†–æ—Å—Ç –ö–∞–ø–∏—Ç–∞–ª–∞</h3>
                        <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">–ò–Ω–≤–µ—Å—Ç–æ—Ä</span>
                    </div>

                    <div class="grid grid-cols-3 sm:grid-cols-4 gap-4">
                        <!-- Jar: Conservative Invest -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-invest" class="liquid liquid-risk"></div>
                            </div>
                            <div id="slider-invest" class="h-28 absolute top-[4px] right-[-8px] opacity-60 hover:opacity-100"></div>
                            <div class="mt-2 text-xs font-bold">–ê–∫—Ü–∏–∏</div>
                            <div class="text-[10px] text-stone-500" id="val-invest">$0</div>
                        </div>

                        <!-- Jar: Speculation -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-spec" class="liquid liquid-risk" style="filter: hue-rotate(45deg);"></div>
                            </div>
                            <div id="slider-spec" class="h-28 absolute top-[4px] right-[-8px] opacity-60 hover:opacity-100"></div>
                            <div class="mt-2 text-xs font-bold text-purple-700">–ö—Ä–∏–ø—Ç–∞</div>
                            <div class="text-[10px] text-stone-500" id="val-spec">$0</div>
                        </div>

                         <!-- Jar: Education -->
                         <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-edu" class="liquid liquid-safe" style="filter: saturate(0.5);"></div>
                            </div>
                            <div id="slider-edu" class="h-28 absolute top-[4px] right-[-8px] opacity-60 hover:opacity-100"></div>
                            <div class="mt-2 text-xs font-bold">–ù–∞–≤—ã–∫–∏</div>
                            <div class="text-[10px] text-stone-500" id="val-edu">$0</div>
                        </div>
                    </div>
                </div>

                <!-- Next Turn Button -->
                <div class="flex justify-center pt-4 pb-12">
                    <button onclick="game.nextTurn()" class="group relative bg-stone-900 text-white font-bold text-lg py-4 px-16 rounded-2xl shadow-xl hover:shadow-2xl hover:translate-y-[-2px] transition-all active:translate-y-[1px]">
                        <span class="flex items-center gap-3">
                            –ü—Ä–æ–∂–∏—Ç—å –ú–µ—Å—è—Ü
                            <span class="bg-stone-700 rounded-full w-6 h-6 flex items-center justify-center text-xs group-hover:bg-emerald-500 transition-colors">‚ñ∂</span>
                        </span>
                        <div class="absolute -bottom-6 left-0 w-full text-center text-xs text-stone-400 font-normal opacity-0 group-hover:opacity-100 transition-opacity">
                            –ü—Ä–æ–∏–∑–æ–π–¥—É—Ç —Å–æ–±—ã—Ç–∏—è –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è %
                        </div>
                    </button>
                </div>

            </div>

            <!-- RIGHT COLUMN: FEEDBACK -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Wealth Chart -->
                <div class="glass-panel p-4 rounded-xl">
                    <h4 class="font-bold text-xs text-stone-400 uppercase mb-2">–î–∏–Ω–∞–º–∏–∫–∞ –ö–∞–ø–∏—Ç–∞–ª–∞</h4>
                    <div class="chart-wrapper">
                        <canvas id="wealthChart"></canvas>
                    </div>
                    <div class="flex justify-center gap-4 mt-2 text-[10px] text-stone-500">
                        <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-emerald-500"></div>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</div>
                        <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-indigo-500"></div>–ê–∫—Ç–∏–≤—ã</div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="glass-panel p-4 rounded-xl space-y-3 text-sm">
                    <div class="flex justify-between border-b border-stone-100 pb-1">
                        <span class="text-stone-500">üè¶ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</span>
                        <span id="stat-savings" class="font-mono font-bold text-emerald-600">$0</span>
                    </div>
                    <div class="flex justify-between border-b border-stone-100 pb-1 opacity-50 transition-opacity" id="row-assets">
                        <span class="text-stone-500">üìà –ê–∫—Ç–∏–≤—ã</span>
                        <span id="stat-assets" class="font-mono font-bold text-indigo-600">$0</span>
                    </div>
                    <div class="flex justify-between pt-1">
                        <span class="text-stone-500">üí∞ –ö–∞–ø–∏—Ç–∞–ª</span>
                        <span id="stat-total" class="font-mono font-bold text-stone-800">$0</span>
                    </div>
                    <div class="mt-2 text-xs text-center text-stone-400">
                        –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥: <span id="stat-passive" class="font-bold text-emerald-600">+$0</span>/–º–µ—Å
                    </div>
                </div>

                <!-- Event Log -->
                <div class="glass-panel p-4 rounded-xl h-64 flex flex-col">
                    <h4 class="font-bold text-xs text-stone-400 uppercase mb-2">–ñ—É—Ä–Ω–∞–ª –°–æ–±—ã—Ç–∏–π</h4>
                    <div id="event-log" class="flex-grow overflow-y-auto space-y-2 text-xs pr-1 custom-scrollbar">
                        <div class="text-stone-400 text-center mt-8 italic">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –ü—É—Ç—å", —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é.</div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Modals / Overlays -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-emerald-400 to-indigo-500"></div>
            <div class="text-5xl mb-4" id="modal-icon">üèÜ</div>
            <h2 class="text-2xl font-bold mb-2 text-stone-800" id="modal-title">Title</h2>
            <p class="text-stone-600 mb-6 text-sm leading-relaxed" id="modal-text">Content</p>
            <button onclick="closeModal()" class="w-full bg-stone-800 text-white py-3 rounded-lg font-bold hover:bg-stone-700 transition-colors">
                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 flex flex-col gap-2 pointer-events-none"></div>

    <script>
        // --- CONFIG & CONSTANTS ---
        const CONFIG = {
            baseIncome: 1000,
            thresholds: {
                phase2: 3000, // Savings needed to unlock investor mode
                victory: 2000, // Passive income needed to win OR Total Wealth
                victoryWealth: 50000,
                survival: 500,
                comfort: 300
            }
        };

        // --- GAME STATE & LOGIC ---
        class Game {
            constructor() {
                this.reset();
            }

            reset() {
                this.turn = 1;
                this.phase = 1; // 1 = Saver, 2 = Investor
                this.state = {
                    health: 100,
                    happiness: 100,
                    cash: 0,        // Liquid Savings
                    assets: 0,      // Investments (Stocks/Crypto)
                    salaryLevel: 0, // Increases via Education
                    education: 0    // Track spent on edu
                };
                this.inputs = {
                    survival: 500,
                    comfort: 300,
                    invest: 0,
                    spec: 0,
                    edu: 0
                };
                this.history = {
                    labels: [],
                    cash: [],
                    assets: []
                };
                this.isGameOver = false;
            }

            startGame() {
                document.getElementById('screen-intro').classList.add('hidden');
                document.getElementById('screen-game').classList.remove('hidden');
                document.getElementById('screen-game').classList.add('flex');
                
                this.initSliders();
                this.initChart();
                this.updateUI();
                this.log("üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –±—é–¥–∂–µ—Ç –Ω–∞ –Ω—É–∂–¥—ã. –û—Å—Ç–∞—Ç–æ–∫ –ø–æ–π–¥–µ—Ç –≤ –∫–æ–ø–∏–ª–∫—É.", "neutral");
            }

            initSliders() {
                // Helper to create slider
                const createSlider = (id, max) => {
                    const el = document.getElementById(`slider-${id}`);
                    if(!el) return;
                    
                    noUiSlider.create(el, {
                        start: this.inputs[id],
                        connect: [false, true],
                        direction: 'rtl',
                        orientation: 'vertical',
                        range: { 'min': 0, 'max': max },
                        step: 10
                    });

                    el.noUiSlider.on('update', (values) => {
                        this.inputs[id] = parseInt(values[0]);
                        // Visual updates
                        document.getElementById(`val-${id}`).innerText = `$${this.inputs[id]}`;
                        const percent = Math.min(100, (this.inputs[id] / max) * 100);
                        const fillEl = document.getElementById(`fill-${id}`);
                        if(fillEl) fillEl.style.height = `${percent}%`;
                        
                        this.calcPreview();
                    });
                };

                createSlider('survival', 1500);
                createSlider('comfort', 1000);
                createSlider('invest', 1500);
                createSlider('spec', 1000);
                createSlider('edu', 1000);
            }

            // Calculate numbers without applying them (for UI)
            calcPreview() {
                const income = CONFIG.baseIncome + (this.state.salaryLevel * 100); // $100 raise per level
                
                // Asset returns (Preview only)
                const passive = Math.floor(this.state.assets * 0.005); // ~0.5% monthly approx 6% APY

                const totalIncome = income + passive;

                // Expenses
                let expenses = this.inputs.survival + this.inputs.comfort;
                if (this.phase === 2) {
                    expenses += this.inputs.invest + this.inputs.spec + this.inputs.edu;
                }

                const free = totalIncome - expenses;

                // Update UI Summary
                document.getElementById('ui-income').innerText = `$${totalIncome}`;
                document.getElementById('ui-expense').innerText = `$${expenses}`;
                const freeEl = document.getElementById('ui-free');
                freeEl.innerText = `$${free}`;
                
                // Color code free money
                const freeCard = document.getElementById('card-free');
                if (free >= 0) {
                    freeEl.className = "text-lg font-bold text-emerald-700";
                    freeCard.className = "glass-panel p-3 rounded-lg text-center bg-emerald-50";
                } else {
                    freeEl.className = "text-lg font-bold text-rose-700";
                    freeCard.className = "glass-panel p-3 rounded-lg text-center bg-rose-50";
                }

                // Update Savings Jar Preview (It catches the overflow in Phase 1)
                const savingsFill = document.getElementById('fill-savings');
                const savingsVal = document.getElementById('val-savings');
                
                // In visualization, we just show current savings + projected addition
                if(savingsVal) savingsVal.innerText = `$${Math.floor(this.state.cash + (free > 0 ? free : 0))}`;
                
                return { totalIncome, expenses, free, passive };
            }

            nextTurn() {
                if(this.isGameOver) return;

                const budget = this.calcPreview();

                // 1. Vital Signs Logic
                if (this.inputs.survival < CONFIG.thresholds.survival) {
                    this.state.health -= 5;
                    this.log("‚ö†Ô∏è –ù–µ—Ö–≤–∞—Ç–∫–∞ –Ω–∞ –µ–¥—É —É–¥–∞—Ä–∏–ª–∞ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é (-5%)", "bad");
                } else if(this.state.health < 100) {
                    this.state.health += 2; // Recover
                }

                if (this.inputs.comfort < CONFIG.thresholds.comfort) {
                    this.state.happiness -= 5;
                    this.log("‚ö†Ô∏è –ê—Å–∫–µ—Ç–∏–∑–º —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (-5%)", "bad");
                } else if(this.state.happiness < 100) {
                    this.state.happiness += 2;
                }

                // 2. Financial Logic
                if (budget.free >= 0) {
                    // Positive flow
                    this.state.cash += budget.free; 
                    
                    // In Phase 2, investments are already deducted from free as expenses,
                    // so we need to add them to asset pool
                    if(this.phase === 2) {
                        this.state.assets += this.inputs.invest;
                        this.state.assets += this.inputs.spec;
                        
                        // Education logic
                        if(this.inputs.edu > 0) {
                            this.state.education += this.inputs.edu;
                            if(this.state.education >= 1000) {
                                this.state.salaryLevel++;
                                this.state.education = 0;
                                this.log("üéì –í—ã –ø–æ–≤—ã—Å–∏–ª–∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é! –î–æ—Ö–æ–¥ –≤—ã—Ä–æ—Å.", "good");
                                this.showToast("–ó–∞—Ä–ø–ª–∞—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞!", "success");
                            }
                        }
                    }
                } else {
                    // Negative flow - eat into savings
                    this.state.cash += budget.free; // adds negative number
                    if (this.state.cash < 0) {
                        this.state.cash = 0;
                        this.state.happiness -= 10;
                        this.log("üí∏ –î–æ–ª–≥–∏! –ü—Ä–∏—à–ª–æ—Å—å –∑–∞–Ω–∏–º–∞—Ç—å. –°—á–∞—Å—Ç—å–µ –ø–∞–¥–∞–µ—Ç.", "bad");
                    }
                }

                // 3. Market & Interest Logic
                // Bank Interest (0.3% monthly)
                this.state.cash = Math.floor(this.state.cash * 1.003);

                if (this.phase === 2 && this.state.assets > 0) {
                    // Market Volatility
                    const marketMood = Math.random(); // 0 to 1
                    let change = 0;
                    
                    // Invest Portion (Steady)
                    // Spec Portion (Volatile) -> simplified into one pool for UI, but let's simulate returns
                    // Let's assume proportional risk based on inputs
                    const riskRatio = (this.inputs.spec + 1) / (this.inputs.invest + this.inputs.spec + 1);
                    
                    if (marketMood > 0.6) {
                        // Good month
                        change = 1.02 + (riskRatio * 0.05); // 2-7% gain
                        this.log(`üìà –†—ã–Ω–æ–∫ —Ä–∞—Å—Ç–µ—Ç. –ê–∫—Ç–∏–≤—ã —É–≤–µ–ª–∏—á–∏–ª–∏—Å—å.`, "neutral");
                    } else if (marketMood < 0.2) {
                        // Bad month
                        change = 0.98 - (riskRatio * 0.10); // 2-12% loss
                        this.log(`üìâ –†—ã–Ω–æ–∫ –ø—Ä–æ—Å–µ–ª. –ü–æ—Ç–µ—Ä–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.`, "bad");
                    } else {
                        change = 1.005; // Flat
                    }
                    
                    this.state.assets = Math.floor(this.state.assets * change);
                }

                // 4. Random Events
                this.handleEvents();

                // 5. Progression Checks
                this.checkPhase();
                this.checkWinLoss(budget.passive);

                // 6. Update History & UI
                this.turn++;
                this.updateHistory();
                this.updateUI();
            }

            handleEvents() {
                if (Math.random() > 0.15) return; // 15% chance

                const events = [
                    { phase: 1, text: "ü¶∑ –ó—É–±–Ω–∞—è –±–æ–ª—å. –í—Ä–∞—á —Å—Ç–æ–∏–ª $150.", cash: -150 },
                    { phase: 1, text: "üéÅ –ù–∞—à–ª–∏ $50 –≤ –∑–∏–º–Ω–µ–π –∫—É—Ä—Ç–∫–µ!", cash: 50 },
                    { phase: 1, text: "‚õàÔ∏è –ü—Ä–æ—Ç–µ–∫–ª–∞ –∫—Ä—ã—à–∞. –†–µ–º–æ–Ω—Ç $300.", cash: -300 },
                    { phase: 2, text: "üìâ –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –∫—Ä–∏–ø—Ç–æ—Ä—ã–Ω–∫–∞.", assetsMult: 0.85 },
                    { phase: 2, text: "üöÄ –ê–∫—Ü–∏–∏ —Ç–µ—Ö–Ω–æ-–≥–∏–≥–∞–Ω—Ç–∞ –≤–∑–ª–µ—Ç–µ–ª–∏!", assetsMult: 1.15 },
                    { phase: 2, text: "üíº –§—Ä–∏–ª–∞–Ω—Å-–ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–Ω–µ—Å $500.", cash: 500 }
                ];

                // Filter valid events
                const validEvents = events.filter(e => e.phase <= this.phase);
                const evt = validEvents[Math.floor(Math.random() * validEvents.length)];

                this.log(`üîî –°–æ–±—ã—Ç–∏–µ: ${evt.text}`, evt.cash < 0 || evt.assetsMult < 1 ? "bad" : "good");

                if(evt.cash) this.state.cash += evt.cash;
                if(evt.assetsMult) this.state.assets = Math.floor(this.state.assets * evt.assetsMult);
            }

            checkPhase() {
                if (this.phase === 1 && this.state.cash >= CONFIG.thresholds.phase2) {
                    this.phase = 2;
                    this.showModal(
                        "üîì –£—Ä–æ–≤–µ–Ω—å 2 –û—Ç–∫—Ä—ã—Ç!", 
                        "–í—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞–¥–µ–∂–Ω—É—é –ø–æ–¥—É—à–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ò–Ω–≤–µ—Å—Ç–æ—Ä–∞. <br><br>–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: –ê–∫—Ü–∏–∏, –†–∏—Å–∫–æ–≤—ã–µ –∞–∫—Ç–∏–≤—ã, –û–±—É—á–µ–Ω–∏–µ.",
                        "üöÄ"
                    );
                    
                    // Unlock Animation UI
                    const panel = document.getElementById('phase-2-panel');
                    panel.classList.remove('locked-section');
                    panel.classList.add('animate-unlock');
                    document.getElementById('lock-overlay').style.display = 'none';
                    
                    // Update HUD Identity
                    document.getElementById('ui-role-name').innerText = "–û–ø—ã—Ç–Ω—ã–π –ò–Ω–≤–µ—Å—Ç–æ—Ä";
                    document.getElementById('ui-phase-icon').innerText = "üöÄ";
                    document.getElementById('row-assets').classList.remove('opacity-50');

                    // Reset animation class after play
                    setTimeout(() => panel.classList.remove('animate-unlock'), 2000);
                }
            }

            checkWinLoss(passive) {
                // Bounds
                this.state.health = Math.min(100, Math.max(0, this.state.health));
                this.state.happiness = Math.min(100, Math.max(0, this.state.happiness));

                if (this.state.health <= 0 || this.state.happiness <= 0) {
                    this.showModal("–ò–≥—Ä–∞ –û–∫–æ–Ω—á–µ–Ω–∞", "–í—ã –≤—ã–≥–æ—Ä–µ–ª–∏ –∏–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ. –§–∏–Ω–∞–Ω—Å—ã –≤–∞–∂–Ω—ã, –Ω–æ –Ω–µ —Ü–µ–Ω–æ–π –∂–∏–∑–Ω–∏.", "üíÄ");
                    this.isGameOver = true;
                    return;
                }

                // Win Condition
                const totalWealth = this.state.cash + this.state.assets;
                if (passive >= 2000 || totalWealth >= CONFIG.thresholds.victoryWealth) {
                    this.showModal("–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –°–≤–æ–±–æ–¥–∞!", `–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–∞–ø–∏—Ç–∞–ª–∞ $${totalWealth.toLocaleString()} –∏ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ $${passive}/–º–µ—Å. –í—ã –ø–æ–±–µ–¥–∏–ª–∏ —Å–∏—Å—Ç–µ–º—É!`, "üèÜ");
                    this.isGameOver = true;
                }
            }

            updateHistory() {
                this.history.labels.push(this.turn);
                this.history.cash.push(this.state.cash);
                this.history.assets.push(this.state.assets);

                // Update Chart
                wealthChart.data.labels = this.history.labels;
                wealthChart.data.datasets[0].data = this.history.cash;
                wealthChart.data.datasets[1].data = this.history.assets;
                wealthChart.update();
            }

            updateUI() {
                // Vitals
                document.getElementById('ui-turn').innerText = this.turn;
                document.getElementById('ui-health').innerText = Math.floor(this.state.health) + '%';
                document.getElementById('ui-happy').innerText = Math.floor(this.state.happiness) + '%';
                
                // Stats
                document.getElementById('stat-savings').innerText = '$' + this.state.cash.toLocaleString();
                document.getElementById('stat-assets').innerText = '$' + this.state.assets.toLocaleString();
                document.getElementById('stat-total').innerText = '$' + (this.state.cash + this.state.assets).toLocaleString();
                document.getElementById('stat-passive').innerText = '+$' + Math.floor(this.state.assets * 0.005);

                // Goal Bar
                let goalPct = 0;
                let goalLabel = "";
                
                if (this.phase === 1) {
                    goalPct = (this.state.cash / CONFIG.thresholds.phase2) * 100;
                    goalLabel = `–¶–µ–ª—å: –ü–æ–¥—É—à–∫–∞ $${CONFIG.thresholds.phase2}`;
                } else {
                    goalPct = ((this.state.cash + this.state.assets) / CONFIG.thresholds.victoryWealth) * 100;
                    goalLabel = `–¶–µ–ª—å: –ö–∞–ø–∏—Ç–∞–ª $${CONFIG.thresholds.victoryWealth.toLocaleString()}`;
                }
                
                document.getElementById('bar-goal').style.width = Math.min(100, goalPct) + '%';
                document.getElementById('ui-goal-percent').innerText = Math.floor(goalPct) + '%';
                document.getElementById('ui-goal-label').innerText = goalLabel;

                // Visual Jars (Liquid Level)
                // For savings, we map 0 to Threshold for visual filling in Phase 1
                const savingsMax = this.phase === 1 ? CONFIG.thresholds.phase2 : CONFIG.thresholds.victoryWealth; 
                // Just aesthetic capping
                const savingsH = Math.min(100, (this.state.cash / (this.phase === 1 ? 3000 : 10000)) * 100);
                document.getElementById('fill-savings').style.height = `${savingsH}%`;

                this.calcPreview(); // Refresh summary numbers
            }

            log(msg, type) {
                const logEl = document.getElementById('event-log');
                const div = document.createElement('div');
                let color = "border-stone-300 bg-white";
                if (type === "good") color = "border-emerald-400 bg-emerald-50";
                if (type === "bad") color = "border-rose-400 bg-rose-50";
                
                div.className = `p-2 rounded border-l-2 text-stone-700 mb-2 ${color} animate-pulse`;
                div.innerHTML = `<span class="font-bold text-xs opacity-50">–ú–µ—Å ${this.turn}:</span> ${msg}`;
                
                // Remove empty state text
                if(logEl.children[0]?.classList.contains('text-center')) logEl.innerHTML = '';
                
                logEl.prepend(div);
                if (logEl.children.length > 20) logEl.lastElementChild.remove();
            }

            showToast(msg, type) {
                const container = document.getElementById('toast-container');
                const el = document.createElement('div');
                el.className = `toast-enter px-4 py-2 rounded shadow-lg text-white text-sm font-bold ${type === 'success' ? 'bg-emerald-600' : 'bg-stone-800'}`;
                el.innerText = msg;
                container.appendChild(el);
                setTimeout(() => el.remove(), 3000);
            }

            showModal(title, text, icon) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-text').innerHTML = text; // Allow HTML
                document.getElementById('modal-icon').innerText = icon;
                document.getElementById('modal-overlay').classList.remove('hidden');
            }
        }

        // --- CHART SETUP ---
        let wealthChart;
        function initChartSetup() {
            const ctx = document.getElementById('wealthChart').getContext('2d');
            wealthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è',
                            data: [],
                            borderColor: '#059669', // Emerald
                            backgroundColor: 'rgba(5, 150, 105, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
                            data: [],
                            borderColor: '#4f46e5', // Indigo
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { 
                            beginAtZero: true,
                            grid: { color: '#f5f5f4' }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    }
                }
            });
        }

        // --- INIT ---
        const game = new Game();
        game.initChart = initChartSetup;

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
            if(game.isGameOver) location.reload();
        }
    </script>
</body>
</html>
```
