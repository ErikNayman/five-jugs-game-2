<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>5 –ö—É–≤—à–∏–Ω–æ–≤</title>

<!-- Tailwind + Chart.js + noUiSlider -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link  href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.js"></script>

<style>
/* –∫—É–≤—à–∏–Ω—ã-–ø–æ–ª–∑—É–Ω–∫–∏ */
.jar-wrap{width:120px;display:flex;flex-direction:column;align-items:center}
.jar{width:80px;height:160px;border:4px solid #555;border-radius:8px 8px 32px 32px;
     background:#fff;overflow:hidden;position:relative}
.liquid{position:absolute;bottom:0;left:0;width:100%;height:0;
        background:linear-gradient(#4ade80,#16a34a);transition:.25s}
.slider-v{height:160px;margin-top:12px}
.jar-caption{height:60px;font:600 15px/1.1 sans-serif;text-align:center}

/* –≤–µ—Ä—Ö–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω—ã */
.glass-wrap{width:100px;display:flex;flex-direction:column;align-items:center}
.glass{width:70px;height:140px;border:4px solid #555;border-radius:8px 8px 28px 28px;
       background:#fff;overflow:hidden;position:relative}
.liquid-glass{position:absolute;bottom:0;left:0;width:100%;height:0;transition:.25s}
.neg-liquid{background:#e11d48!important}.neg-text{color:#e11d48!important}

/* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª–æ—Å—ã */
.vbar{width:26px;height:140px;border-radius:13px;background:#d1d5db;overflow:hidden;position:relative}
.vbar-fill{position:absolute;bottom:0;width:100%;height:0;transition:.25s}
.vbar-text{position:absolute;top:4px;width:100%;font:700 14px/1 sans-serif;text-align:center}

/* –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ */
.mini-chart-box{width:100px;height:140px;display:flex;align-items:center;
                justify-content:center;position:relative}
#scoreChart{width:100px!important;height:100px!important}
#scoreBig{position:absolute;top:0;width:100%;font:700 18px/1 sans-serif;text-align:center}
</style>
</head>
<body class="bg-gray-100">

<!-- üõà –º–∏–Ω–∏-—Ç—É—Ç–æ—Ä–∏–∞–ª -->
<div id="tutorial" class="fixed inset-0 bg-black/70 flex items-center justify-center hidden">
  <div class="bg-white rounded shadow max-w-md w-11/12 p-6 text-center space-y-4">
    <h3 id="tutTitle" class="text-xl font-bold"></h3>
    <p  id="tutText"></p>
    <button id="tutNext" class="bg-blue-600 text-white px-4 py-2 rounded">–î–∞–ª—å—à–µ</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –°–¢–ê–†–¢ ‚îÄ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="start-screen" class="min-h-screen flex flex-col items-center justify-center p-6">
  <h1 class="text-5xl font-bold mb-6"><span class="mr-2">üí∞</span>5 –ö—É–≤—à–∏–Ω–æ–≤</h1>

  <div class="bg-white p-6 rounded shadow w-full max-w-sm space-y-4 text-left">

    <!-- –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
    <p class="font-semibold">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã:</p>
    <div class="flex gap-4">
      <button onclick="startGame(24)" class="flex-1 bg-green-600 text-white py-2 rounded">24 –º–µ—Å</button>
      <button onclick="startGame(36)" class="flex-1 bg-blue-600  text-white py-2 rounded">36 –º–µ—Å</button>
    </div>

    <!-- —Ä–µ–∂–∏–º -->
    <p class="font-semibold mt-4 mb-1">–ö–∞–∫ –Ω–∞—á–∞—Ç—å?</p>
    <label class="block"><input type="radio" name="mode" value="role" checked> <span class="ml-1">–í—ã–±—Ä–∞—Ç—å —Ä–æ–ª—å</span></label>
    <label class="block"><input type="radio" name="mode" value="goal"> <span class="ml-1">–í—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å</span></label>
    <label class="block"><input type="radio" name="mode" value="free"> <span class="ml-1">–°–≤–æ–±–æ–¥–Ω—ã–π –ø–ª–∞–Ω</span></label>

    <!-- —Ä–æ–ª–∏ -->
    <div id="roleBlock" class="mt-4">
      <p class="font-semibold mb-1">–†–æ–ª—å:</p>
      <label class="mr-4"><input type="radio" name="role" value="Saver" checked> Saver</label>
      <label class="mr-4"><input type="radio" name="role" value="Investor"> Investor</label>
      <label class="mr-4"><input type="radio" name="role" value="Spec"> Speculator</label>
    </div>

    <!-- —Ü–µ–ª–∏ -->
    <div id="goalBlock" class="mt-4 hidden">
      <label class="font-semibold mb-1">–¶–µ–ª—å:</label>
      <select id="goalSelect" class="w-full border p-2 rounded">
        <option value="buffer">–ü–æ–¥—É—à–∫–∞ 12 –º–µ—Å</option>
        <option value="passive">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ $1000/–º–µ—Å</option>
        <option value="tenk">–ù–∞–∫–æ–ø–∏—Ç—å $10000</option>
      </select>
    </div>

    <!-- –∞–≤—Ç–æ–¥–æ–ª–∏–≤ -->
    <label class="flex items-center space-x-2 mt-4">
      <input id="autoAdjust" type="checkbox" class="h-4 w-4 text-blue-600 rounded">
      <span class="text-sm">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –≤ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</span>
    </label>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ò–ì–†–ê ‚îÄ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="game-screen" class="hidden p-6 space-y-6 max-w-7xl mx-auto">

  <!-- –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (—Å—Ç–∞–∫–∞–Ω—ã/–ø–æ–ª–æ—Å—ã/–≥—Ä–∞—Ñ–∏–∫) -->
  <div class="flex flex-wrap gap-6 mb-8 justify-center">
    <div class="glass-wrap"><div class="glass"><div id="glassIncome"  class="liquid-glass" style="background:#82A8AB"></div></div><p class="mt-1 text-sm font-semibold">–î–æ—Ö–æ–¥—ã</p></div>
    <div class="glass-wrap"><div class="glass"><div id="glassExpenses" class="liquid-glass" style="background:#A77F4B"></div></div><p class="mt-1 text-sm font-semibold">–†–∞—Å—Ö–æ–¥—ã</p></div>
    <div class="glass-wrap"><div class="glass"><div id="glassSavings"  class="liquid-glass" style="background:#728565"></div></div><p class="mt-1 text-sm font-semibold">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</p></div>
    <div class="glass-wrap"><div class="glass"><div id="glassInvest"   class="liquid-glass" style="background:#3B4550"></div></div><p class="mt-1 text-sm font-semibold">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</p></div>
    <div class="glass-wrap"><div class="glass"><div id="glassSpec"    class="liquid-glass" style="background:#BF8200"></div></div><p class="mt-1 text-sm font-semibold">–°–ø–µ–∫—É–ª—è—Ü–∏–∏</p></div>
    <div class="glass-wrap"><div class="vbar"><div id="vHealthFill" class="vbar-fill" style="background:#22c55e"></div><span id="vHealthTxt" class="vbar-text">100%</span></div><p class="mt-1 text-sm font-semibold">–ó–¥–æ—Ä–æ–≤—å–µ</p></div>
    <div class="glass-wrap"><div class="vbar"><div id="vHappyFill"  class="vbar-fill" style="background:#facc15"></div><span id="vHappyTxt"  class="vbar-text">90%</span></div><p class="mt-1 text-sm font-semibold">–°—á–∞—Å—Ç—å–µ</p></div>
    <div class="glass-wrap"><div class="mini-chart-box"><canvas id="scoreChart"></canvas><span id="scoreBig">0</span></div><p class="mt-1 text-sm font-semibold">–ë–∞–ª–ª—ã</p></div>
  </div>

  <!-- –¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã —Ü–∏—Ñ—Ä–∞–º–∏ -->
  <div class="grid grid-cols-2 gap-6">
    <div><label class="font-semibold">–î–æ—Ö–æ–¥—ã ($)</label><p id="incomeDisplay" class="border p-2 rounded bg-gray-50">$0</p></div>
    <div><label class="font-semibold">–†–∞—Å—Ö–æ–¥—ã ($)</label><p id="expensesDisplay" class="border p-2 rounded bg-gray-50">$0</p></div>
  </div>

  <!-- 6 –∫—É–≤—à–∏–Ω–æ–≤ -->
  <div class="flex flex-wrap gap-6 mb-8">
    <!-- —à–∞–±–ª–æ–Ω -->
    <template id="jarTpl">
      <div class="jar-wrap">
        <div class="jar"><div class="liquid"></div></div>
        <div class="slider-v"></div>
        <div class="jar-caption mt-1"></div>
        <input type="hidden" class="hidden-field">
      </div>
    </template>
  </div>

  <!-- –¥–æ–ø. —Ä–∞–±–æ—Ç–∞ -->
  <label class="font-semibold" for="extra">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</label>
  <select id="extra" class="border p-2 rounded max-w-xs mb-4"><option value="–Ω–µ—Ç">–Ω–µ—Ç</option><option value="–¥–∞">–¥–∞</option></select>

  <!-- —Ö–æ–¥ -->
  <button onclick="runTurn()" class="w-full py-2 bg-blue-600 text-white font-bold rounded">–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ö–æ–¥</button>

  <!-- –∫—Ä–∞—Ç–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="text-center space-y-2">
    <p>–•–æ–¥: <span id="turn">0</span> / <span id="maxTurns">0</span></p>
    <p>–°–æ–±—ã—Ç–∏–µ: <span id="event">-</span></p>
    <p>–°–≤–æ–±–æ–¥–Ω—ã–µ $: <span id="free">$0</span></p>
    <p>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è: <span id="savings">$0</span></p>
    <p>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: <span id="investments">$0</span></p>
  </div>

  <!-- –∏—Å—Ç–æ—Ä–∏—è -->
  <div class="mt-8">
    <h2 class="text-xl font-bold text-center mb-2">üìò –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h2>
    <table class="w-full text-sm bg-white rounded shadow overflow-hidden">
      <thead class="bg-gray-200 font-bold"><tr>
        <th class="p-2">–•–æ–¥</th><th class="p-2">–°–æ–±—ã—Ç–∏–µ</th><th class="p-2">–°–≤–æ–±–æ–¥–Ω—ã–µ $</th>
        <th class="p-2">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</th><th class="p-2">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</th>
        <th class="p-2">–ó–¥–æ—Ä–æ–≤—å–µ</th><th class="p-2">–°—á–∞—Å—Ç—å–µ</th></tr></thead>
      <tbody id="historyTable" class="text-center"></tbody>
    </table>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –¥–∞–Ω–Ω—ã–µ —Ä–æ–ª–µ–π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const rolePresets={
  Saver:{p:{survival:40,comfort:20,save:20,invest:10,health:5,edu:5},
         rules:[{t:'min',jar:'save',v:10},{t:'buf',m:12},{t:'ratio',max:50}],
         bonus:true},
  Investor:{p:{survival:40,comfort:20,save:10,invest:20,health:5,edu:5},
            rules:[{t:'min',jar:'invest',v:15},{t:'buf',m:6},{t:'ratio',max:50}],
            bonus:true},
  Spec:{p:{survival:40,comfort:20,save:5,invest:15,health:3,edu:2},
        rules:[{t:'min',jar:'save',v:5},{t:'ratio',max:50}],
        bonus:false}
};

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tutorial slides ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const tut=[['–®–∞–≥ 1/3','–û—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ ‚â• 10 % –¥–æ—Ö–æ–¥–∞ ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ ¬´–ø–æ–¥—É—à–∫—É¬ª.'],
           ['–®–∞–≥ 2/3','–ü–æ–¥—É—à–∫–∞ 12 –º–µ—Å ‚Üí –∏–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ ‚â• 15 %.'],
           ['–®–∞–≥ 3/3','–ë–∞–∑–æ–≤—ã–µ —Ç—Ä–∞—Ç—ã ‚â§ 50 % –¥–æ—Ö–æ–¥–∞.']];
function showTut(){let i=0,bx=tutorial,ttl=tutTitle,txt=tutText,btn=tutNext;
 const ren=()=>{ttl.textContent=tut[i][0];txt.textContent=tut[i][1];
                btn.textContent=i===2?'–ü–æ–Ω—è–ª!':'–î–∞–ª—å—à–µ'};ren();bx.classList.remove('hidden');
 btn.onclick=()=>{i<2?(i++,ren()):(bx.classList.add('hidden'),localStorage.tut=1)}}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ runtime vars ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
let turn=0,maxTurns=0,savings=0,investments=0,health=100,happiness=90;
let activeRules=[],giveBonus=false;
const scores=[];

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ build jars DOM + sliders ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const jars=[['survival','–í—ã–∂–∏–≤–∞–Ω–∏–µ',500],['comfort','–ö–æ–º—Ñ–æ—Ä—Ç',500],
            ['save','–°–±–µ—Ä–µ–∂–µ–Ω–∏—è',0],['invest','–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',0],
            ['healthSpend','–ó–¥–æ—Ä–æ–≤—å–µ',0],['edu','–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',0]];
const row=document.querySelector('#jarsRow');
jars.forEach(([id,label,val])=>{
  const tpl=document.getElementById('jarTpl').content.cloneNode(true);
  const wrap=tpl.querySelector('.jar-wrap');
  wrap.querySelector('.liquid').id=id+'Fill';
  wrap.querySelector('.slider-v').id=id+'Slider';
  wrap.querySelector('.jar-caption').innerHTML=`${label}<br><span id="${id==='save'?'saveLabel':id+'Val'}">${val}</span> $`;
  wrap.querySelector('input').id=id;wrap.querySelector('input').value=val;
  row.appendChild(wrap);
});
/* create sliders */
function buildJar(sliderId,fillId,valId,hiddenId,max){
  const s=document.getElementById(sliderId),fill=document.getElementById(fillId),
        v=document.getElementById(valId),h=document.getElementById(hiddenId);
  noUiSlider.create(s,{start:+h.value,orientation:'vertical',direction:'rtl',
                       step:10,connect:[true,false],range:{min:0,max}});
  s.noUiSlider.on('update',vls=>{
    const n=Math.round(vls[0]);fill.style.height=(n/max*100)+'%';
    v.textContent=n;h.value=n;updateIncomeExpenses();
  });
}
buildJar('survivalSlider','survivalFill','survivalVal','survival',2000);
buildJar('comfortSlider' ,'comfortFill' ,'comfortVal' ,'comfort' ,2000);
buildJar('saveSlider'    ,'saveFill'    ,'saveLabel'  ,'save'    ,2000);
buildJar('investSlider'  ,'investFill'  ,'investVal'  ,'invest'  ,2000);
buildJar('healthSpendSlider','healthSpendFill','healthSpendVal','healthSpend',2000);
buildJar('eduSlider'     ,'eduFill'     ,'eduVal'     ,'edu',       2000);

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const chart=new Chart(document.getElementById('scoreChart').getContext('2d'),{
  type:'line',
  data:{labels:[],datasets:[{data:[],borderColor:'#3b82f6',borderWidth:1,tension:.3,fill:false,pointRadius:0}]},
  options:{responsive:false,animation:false,scales:{x:{display:false},y:{display:false}},
           plugins:{legend:{display:false},tooltip:{enabled:false}}}
});

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const $=id=>document.getElementById(id);
function setGlassHeight(el,val,full){el.style.height=(Math.min(Math.abs(val),full)/full*100)+'%';}
function updateGlasses(income,surv,comf,saveP,invP){
  const full=income*2||1;
  setGlassHeight(glassIncome, income,full);
  setGlassHeight(glassExpenses,surv+comf,full);
  saveP>=0?(glassSavings.classList.remove('neg-liquid'),saveLabel.classList.remove('neg-text')):
            (glassSavings.classList.add('neg-liquid'), saveLabel.classList.add('neg-text'));
  setGlassHeight(glassSavings,saveP,full);
  setGlassHeight(glassInvest ,Math.max(0,invP),full);
}
function updateBars(){
  vHealthFill.style.height=health+'%'; vHappyFill.style.height=happiness+'%';
  vHealthTxt.textContent=health+'%';   vHappyTxt.textContent=happiness+'%';
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –¥–æ—Ö–æ–¥ / —Ä–∞—Å—Ö–æ–¥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function updateIncomeExpenses(){
  const surv=+survival.value,comf=+comfort.value,
        saveP=+save.value,invP=+invest.value,
        hSp=+healthSpend.value,eduP=+edu.value,extra=extra.value;
  let income=1000;if(extra==='–¥–∞')income+=200;
  const spend=surv+comf+saveP+invP+hSp+eduP;
  incomeDisplay.textContent='$'+income;expensesDisplay.textContent='$'+spend;

  /* –∞–≤—Ç–æ–¥–æ–ª–∏–≤ */
  if(autoAdjust.checked){
    const rest=income-spend;
    if(rest>0){document.getElementById('saveSlider').noUiSlider.set(saveP+rest);return;}
  }
  updateGlasses(income,surv,comf,saveP,invP);
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ø—Ä–∞–≤–∏–ª–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function violations(income){
  const pct=x=>x/income*100,surv=+survival.value,comf=+comfort.value,
        sv=+save.value, iv=+invest.value;
  let bad=0;
  activeRules.forEach(r=>{
    if(r.t==='min'   && pct(r.jar==='save'?sv:iv)<r.v)bad++;
    if(r.t==='ratio' && pct(surv+comf)>r.max)bad++;
    if(r.t==='buf'   && (surv+comf)>0 && savings/(surv+comf)<r.m)bad++;
  });
  return bad;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –∏—Å—Ç–æ—Ä–∏—è & –≥—Ä–∞—Ñ–∏–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function pushHistory(evt,free){
  historyTable.insertAdjacentHTML('beforeend',`<tr>
  <td class=p-2>${turn}</td><td class=p-2>${evt}</td>
  <td class=p-2>$${Math.round(free)}</td>
  <td class=p-2>$${Math.round(savings)}</td>
  <td class=p-2>$${Math.round(investments)}</td>
  <td class=p-2>${health}%</td><td class=p-2>${happiness}%</td></tr>`);
}
function updateChart(score){
  chart.data.labels.push(turn);chart.data.datasets[0].data.push(score);
  chart.update();scoreBig.textContent=score;
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function startGame(months){
  maxTurns=months;turn=0;savings=0;investments=0;health=100;happiness=90;
  document.getElementById('maxTurns').textContent=months;

  const mode=document.querySelector('input[name="mode"]:checked').value;
  if(mode==='role'){
    const role=document.querySelector('input[name="role"]:checked').value,
          preset=rolePresets[role];
    activeRules=preset.rules; giveBonus=preset.bonus;
    const baseInc=1000;
    Object.entries(preset.p).forEach(([k,pc])=>{
      document.getElementById(k+'Slider').noUiSlider.set(Math.round(baseInc*pc/10)/10);
    });
    if(role==='Saver' && !localStorage.tut) setTimeout(showTut,250);
  }else{ activeRules=[]; giveBonus=false; }
  document.getElementById('start-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  updateIncomeExpenses(); updateBars();
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —Ö–æ–¥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function runTurn(){
  turn++;
  const surv=+survival.value,comf=+comfort.value,
        saveP=+save.value,invP=+invest.value,
        hSp=+healthSpend.value,eduP=+edu.value,extraOpt=extra.value;
  let income=1000;if(extraOpt==='–¥–∞')income+=200;
  const spend=surv+comf+saveP+invP+hSp+eduP;

  /* —Å–æ–±—ã—Ç–∏–µ */
  let evt='–Ω–∏—á–µ–≥–æ',pen=0,cr=0,r=Math.random();
  if(r<.15){evt='–º–µ–ª–∫–∞—è —Ç—Ä–∞—Ç–∞ ‚Äì$50';pen=-50;}
  else if(r<.25){evt='–∫—Ä–∏–∑–∏—Å -6% –∏–Ω–≤–µ—Å—Ç';cr=investments*0.06;}
  else if(r<.4){evt='–±–æ–ª–µ–∑–Ω—å -5 –∑–¥–æ—Ä–æ–≤—å—è';health=Math.max(0,health-5);}

  const free=income-spend+pen;savings+=saveP+free;
  investments=(investments+invP-cr)*(1+(Math.random()<=.7?Math.random()*0.03:Math.random()*-0.01));

  /* –∑–¥–æ—Ä–æ–≤—å–µ / —Å—á–∞—Å—Ç—å–µ */
  if(evt!=='–±–æ–ª–µ–∑–Ω—å -5 –∑–¥–æ—Ä–æ–≤—å—è'&&surv<500)health-=((500-surv)/500)*100;
  health=Math.max(0,Math.min(100,Math.round(health)));
  if(comf<500)happiness-=((500-comf)/500)*10;happiness=Math.max(0,Math.round(happiness));

  /* –ø—Ä–∞–≤–∏–ª–∞ -> –±–æ–Ω—É—Å */
  const bad=violations(income);
  if(giveBonus) happiness=Math.max(0,Math.min(100,happiness+(bad? -5:+5)));

  /* UI */
  turn.textContent=turn;event.textContent=evt;
  free.textContent='$'+Math.round(free);
  savings.textContent='$'+Math.round(savings);
  investments.textContent='$'+Math.round(investments);
  updateIncomeExpenses();updateBars();pushHistory(evt,free);

  /* –±–∞–ª–ª—ã */
  let score=Math.floor(savings/1e3)+Math.floor(investments/1e3)*2;
  if(health>70)score+=20;if(happiness>70)score+=20;
  if((investments*0.05+savings*0.03)/12>1000)score+=30;
  updateChart(score);

  if(health<=0||happiness<=0||turn>=maxTurns){
    alert((health<=0?'–ó–¥–æ—Ä–æ–≤—å–µ 0':'–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞')+'\n–ë–∞–ª–ª—ã: '+score);
    location.reload();
  }
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –±–ª–æ–∫–æ–≤ —Ä–µ–∂–∏–º–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
document.querySelectorAll('input[name="mode"]').forEach(r=>r.onchange=()=>{
  roleBlock.classList.toggle('hidden',r.value!=='role');
  goalBlock.classList.toggle('hidden',r.value!=='goal');
});

/* –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä */
updateIncomeExpenses();updateBars();
</script>
</body>
</html>
