```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ü–æ—Ç–æ–∫: 5 –ö—É–≤—à–∏–Ω–æ–≤</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- noUiSlider -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.js"></script>

    <!-- Chosen Palette: Warm Neutral & Financial Zen -->
    <!-- Colors: 
         Background: Stone-50 (#fafaf9)
         Surface: White (#ffffff)
         Primary Action: Emerald-600 (#059669) - Growth/Money
         Secondary Action: Amber-500 (#f59e0b) - Warning/Comfort
         Alert: Rose-500 (#f43f5e) - Danger/Health Loss
         Text: Stone-800 (#292524)
    -->

    <!-- Application Structure Plan: 
         1. Hero/Onboarding: A clear, task-oriented entry point where the user selects a Role (Strategy). This sets the context and goals immediately.
         2. Main Game Dashboard (The "Cockpit"): 
            - Top Bar: Critical Vital Signs (Health, Happiness, Wealth, Turn). Always visible.
            - Left/Center Column: The "Jars" (Sliders). This is the primary interaction zone. Grouped logically (Needs vs. Growth vs. Risk) rather than a flat list to reduce cognitive load.
            - Right Column: Visualization & Feedback. Real-time feedback loop. Contains the "Cash Flow" pipes (dynamic CSS heights) and the History Log.
         3. Interaction Flow: Adjust Sliders -> See Projected Impact -> Commit Turn -> Experience Random Event -> Review Result.
         4. Rationale: The original flat list was overwhelming. Grouping creates a "hierarchy of needs" approach. The visuals use CSS "liquid" metaphors to make the concept of "filling jars" intuitive without heavy graphics.
    -->

    <!-- Visualization & Content Choices:
         1. Jars as CSS Elements: Using CSS gradients and absolute positioning to simulate liquid levels. Justification: Lightweight, responsive, and directly ties to the "Jar" metaphor.
         2. Chart.js Line Chart: Tracks Net Worth over time. Goal: Show long-term impact of decisions (Change).
         3. Dynamic Text Blocks: "Advisor" panel updates based on state (e.g., low health warning). Goal: Inform/Guide.
         4. Confirming NO SVG/Mermaid: Icons are Unicode characters. Graphics are CSS/Canvas.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        /* Custom Styles for "Jars" and Sliders */
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* The Jar Container */
        .jar-container {
            position: relative;
            width: 60px;
            height: 140px;
            background: #e7e5e4; /* stone-200 */
            border-radius: 0 0 16px 16px;
            border-left: 2px solid rgba(255,255,255,0.8);
            border-right: 2px solid rgba(255,255,255,0.8);
            border-bottom: 4px solid rgba(255,255,255,0.8);
            overflow: hidden;
            margin: 0 auto;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            transition: height 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            opacity: 0.9;
        }

        .liquid-basic { background: linear-gradient(to top, #f59e0b, #fbbf24); } /* Amber */
        .liquid-growth { background: linear-gradient(to top, #059669, #34d399); } /* Emerald */
        .liquid-risk  { background: linear-gradient(to top, #7c3aed, #a78bfa); } /* Violet */
        .liquid-danger { background: linear-gradient(to top, #e11d48, #fb7185); } /* Rose */

        /* Customizing noUiSlider to look minimal */
        .noUi-target {
            background: #d6d3d1;
            border: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .noUi-connect {
            background: #78716c;
        }
        .noUi-handle {
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: grab;
            background: #fff;
        }
        .noUi-handle:before, .noUi-handle:after { display: none; }
        .noUi-vertical .noUi-handle {
            width: 20px;
            height: 20px;
            right: -5px;
            top: -10px;
        }

        /* Chart Container Strict Styling */
        .chart-wrapper {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 250px;
            margin: 0 auto;
        }

        /* Animations */
        @keyframes pulse-soft {
            0% { box-shadow: 0 0 0 0 rgba(5, 150, 105, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(5, 150, 105, 0); }
            100% { box-shadow: 0 0 0 0 rgba(5, 150, 105, 0); }
        }
        .btn-pulse { animation: pulse-soft 2s infinite; }

        /* Toast Animation */
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 antialiased min-h-screen flex flex-col">

    <!-- 1. INTRO / ONBOARDING SCREEN -->
    <div id="screen-intro" class="flex-grow flex flex-col items-center justify-center p-4 transition-opacity duration-500">
        <div class="max-w-4xl w-full text-center space-y-6">
            <div class="mb-4">
                <span class="text-6xl">üè∫</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-stone-900 tracking-tight">5 –ö—É–≤—à–∏–Ω–æ–≤</h1>
            <p class="text-xl text-stone-600 max-w-2xl mx-auto">
                –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä. –£–ø—Ä–∞–≤–ª—è–π –ø–æ—Ç–æ–∫–∞–º–∏, –±–∞–ª–∞–Ω—Å–∏—Ä—É–π –º–µ–∂–¥—É –∫–æ–º—Ñ–æ—Ä—Ç–æ–º –∏ –±—É–¥—É—â–∏–º, 
                –¥–æ—Å—Ç–∏–≥–∞–π —Ü–µ–ª–µ–π –∏ –Ω–µ —Ç–µ—Ä—è–π –≤–∫—É—Å –∫ –∂–∏–∑–Ω–∏.
            </p>

            <!-- Role Selection Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12 text-left">
                
                <!-- Role: Saver -->
                <div class="glass-panel p-6 rounded-xl hover:ring-2 hover:ring-emerald-500 cursor-pointer transition-all transform hover:-translate-y-1" onclick="selectRole('Saver')">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-3xl">üõ°Ô∏è</span>
                        <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded">–õ–µ–≥–∫–æ</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å</h3>
                    <p class="text-sm text-stone-600 mb-4">
                        <strong>–¶–µ–ª—å:</strong> –ü–æ–¥—É—à–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (3 –º–µ—Å. —Ä–∞—Å—Ö–æ–¥–æ–≤).
                    </p>
                    <ul class="text-xs text-stone-500 space-y-1">
                        <li>‚úÖ –ë–æ–Ω—É—Å –∫ —Å—á–∞—Å—Ç—å—é –∑–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</li>
                        <li>‚ùå –°—Ç—Ä–∞—Ö —Ä–∏—Å–∫–∞ (–Ω–µ—Ç —Å–ø–µ–∫—É–ª—è—Ü–∏–π)</li>
                    </ul>
                </div>

                <!-- Role: Investor -->
                <div class="glass-panel p-6 rounded-xl hover:ring-2 hover:ring-blue-500 cursor-pointer transition-all transform hover:-translate-y-1" onclick="selectRole('Investor')">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-3xl">üìà</span>
                        <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">–ù–æ—Ä–º–∞</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">–ò–Ω–≤–µ—Å—Ç–æ—Ä</h3>
                    <p class="text-sm text-stone-600 mb-4">
                        <strong>–¶–µ–ª—å:</strong> –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ $1000/–º–µ—Å.
                    </p>
                    <ul class="text-xs text-stone-500 space-y-1">
                        <li>‚úÖ –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª +$1000</li>
                        <li>‚ö†Ô∏è –ù—É–∂–Ω–æ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å >15% –¥–æ—Ö–æ–¥–∞</li>
                    </ul>
                </div>

                <!-- Role: Speculator -->
                <div class="glass-panel p-6 rounded-xl hover:ring-2 hover:ring-purple-500 cursor-pointer transition-all transform hover:-translate-y-1" onclick="selectRole('Spec')">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-3xl">üöÄ</span>
                        <span class="bg-purple-100 text-purple-800 text-xs font-bold px-2 py-1 rounded">–°–ª–æ–∂–Ω–æ</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">–°–ø–µ–∫—É–ª—è–Ω—Ç</h3>
                    <p class="text-sm text-stone-600 mb-4">
                        <strong>–¶–µ–ª—å:</strong> –ö–∞–ø–∏—Ç–∞–ª $10,000 (–±—ã—Å—Ç—Ä–æ).
                    </p>
                    <ul class="text-xs text-stone-500 space-y-1">
                        <li>‚úÖ –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ / –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä–∞–¥–∞</li>
                        <li>‚ö†Ô∏è –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∞</li>
                    </ul>
                </div>
            </div>

            <!-- Difficulty & Settings -->
            <div class="mt-8 flex justify-center gap-6 text-sm">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="intro-auto-save" class="rounded text-emerald-600 focus:ring-emerald-500" checked>
                    <span>–ê–≤—Ç–æ-–¥–æ–ª–∏–≤ –æ—Å—Ç–∞—Ç–∫–∞ –≤ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</span>
                </label>
            </div>
        </div>
    </div>

    <!-- 2. GAME DASHBOARD (Hidden initially) -->
    <div id="screen-game" class="hidden flex-col min-h-screen">
        
        <!-- Top Stats Bar -->
        <header class="bg-white border-b border-stone-200 sticky top-0 z-20 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-3">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    
                    <!-- Left: Brand & Turn -->
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-lg tracking-tight">5 –ö—É–≤—à–∏–Ω–æ–≤</span>
                        <div class="bg-stone-100 px-3 py-1 rounded-full text-sm font-mono border border-stone-200">
                            –•–æ–¥: <span id="ui-turn" class="font-bold text-stone-900">1</span>
                        </div>
                        <div class="text-xs text-stone-500 hidden md:block" id="ui-goal-hint">–¶–µ–ª—å: ...</div>
                    </div>

                    <!-- Center: Vitals (Health & Happiness) -->
                    <div class="flex gap-6 w-full md:w-auto justify-center">
                        <!-- Health -->
                        <div class="flex items-center gap-2" title="–ó–¥–æ—Ä–æ–≤—å–µ">
                            <span class="text-xl">‚ù§Ô∏è</span>
                            <div class="w-24 h-3 bg-stone-200 rounded-full overflow-hidden">
                                <div id="bar-health" class="h-full bg-rose-500 transition-all duration-500" style="width: 100%"></div>
                            </div>
                            <span id="txt-health" class="text-xs font-bold w-8">100%</span>
                        </div>
                        <!-- Happiness -->
                        <div class="flex items-center gap-2" title="–°—á–∞—Å—Ç—å–µ">
                            <span class="text-xl">üòÉ</span>
                            <div class="w-24 h-3 bg-stone-200 rounded-full overflow-hidden">
                                <div id="bar-happy" class="h-full bg-amber-400 transition-all duration-500" style="width: 100%"></div>
                            </div>
                            <span id="txt-happy" class="text-xs font-bold w-8">100%</span>
                        </div>
                    </div>

                    <!-- Right: Wealth Summary -->
                    <div class="flex items-center gap-4 text-right">
                        <div>
                            <div class="text-xs text-stone-500 uppercase tracking-wider">–ö–∞–ø–∏—Ç–∞–ª</div>
                            <div id="ui-total-wealth" class="font-bold text-emerald-700 text-lg">$0</div>
                        </div>
                        <div>
                            <div class="text-xs text-stone-500 uppercase tracking-wider">–ü–∞—Å—Å–∏–≤</div>
                            <div id="ui-passive-income" class="font-bold text-blue-600 text-sm">+$0/–º–µ—Å</div>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Bar towards Goal -->
                <div class="mt-2 w-full h-1 bg-stone-100 rounded-full overflow-hidden">
                    <div id="bar-goal" class="h-full bg-emerald-500 transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <main class="flex-grow max-w-7xl mx-auto w-full p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- COLUMN 1: CONTROLS (The Jars) - Spans 8 cols -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Section Intro -->
                <div class="bg-emerald-50 border border-emerald-100 p-4 rounded-lg flex items-start gap-3">
                    <span class="text-2xl">üß†</span>
                    <div>
                        <h4 class="font-bold text-emerald-900">–¶–µ–Ω—Ç—Ä –ü—Ä–∏–Ω—è—Ç–∏—è –†–µ—à–µ–Ω–∏–π</h4>
                        <p class="text-sm text-emerald-800">
                            –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–∞—à –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç. –î–≤–∏–≥–∞–π—Ç–µ –ø–æ–ª–∑—É–Ω–∫–∏, —á—Ç–æ–±—ã —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å ¬´–í—ã–∂–∏–≤–∞–Ω–∏–µ¬ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞—Ç—ã) –∏ ¬´–†–æ—Å—Ç¬ª. –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–≤–æ–±–æ–¥–Ω—ã–º –æ—Å—Ç–∞—Ç–∫–æ–º!
                        </p>
                    </div>
                </div>

                <!-- Budget Summary Row -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <div class="glass-panel p-4 rounded-lg text-center">
                        <div class="text-sm text-stone-500">–î–æ—Ö–æ–¥—ã (–ê–∫—Ç–∏–≤ + –ü–∞—Å—Å–∏–≤)</div>
                        <div id="ui-income-total" class="text-xl font-bold text-emerald-600">$1000</div>
                    </div>
                    <div class="glass-panel p-4 rounded-lg text-center">
                        <div class="text-sm text-stone-500">–†–∞—Å—Ö–æ–¥—ã (–ü–ª–∞–Ω)</div>
                        <div id="ui-expenses-total" class="text-xl font-bold text-rose-600">$0</div>
                    </div>
                    <div class="glass-panel p-4 rounded-lg text-center border-l-4" id="ui-free-money-card">
                        <div class="text-sm text-stone-500">–°–≤–æ–±–æ–¥–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫</div>
                        <div id="ui-free-money" class="text-xl font-bold text-stone-800">$0</div>
                    </div>
                </div>

                <!-- JAR GROUPS -->
                
                <!-- Group 1: Basics (Survival & Comfort) -->
                <div class="glass-panel rounded-xl p-5 mb-4">
                    <h3 class="text-sm font-bold text-stone-400 uppercase tracking-widest mb-4 border-b pb-2">–ë–∞–∑–æ–≤—ã–µ –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8">
                        <!-- Jar: Survival -->
                        <div class="text-center relative group">
                            <div class="jar-container">
                                <div id="fill-survival" class="liquid liquid-basic"></div>
                            </div>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity bg-black/5 text-xs font-bold text-stone-700">
                                –ú–∏–Ω $500
                            </div>
                            <div id="slider-survival" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–í—ã–∂–∏–≤–∞–Ω–∏–µ</div>
                            <div class="text-xs text-stone-500" id="val-survival">$500</div>
                        </div>

                        <!-- Jar: Comfort -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-comfort" class="liquid liquid-basic"></div>
                            </div>
                            <div id="slider-comfort" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–ö–æ–º—Ñ–æ—Ä—Ç</div>
                            <div class="text-xs text-stone-500" id="val-comfort">$500</div>
                        </div>

                        <!-- Jar: Health Spend -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-healthSpend" class="liquid liquid-danger"></div>
                            </div>
                            <div id="slider-healthSpend" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–ó–¥–æ—Ä–æ–≤—å–µ</div>
                            <div class="text-xs text-stone-500" id="val-healthSpend">$0</div>
                        </div>
                    </div>
                </div>

                <!-- Group 2: Growth (Save, Invest, Edu) -->
                <div class="glass-panel rounded-xl p-5 mb-4 border-t-4 border-emerald-500">
                    <h3 class="text-sm font-bold text-emerald-600 uppercase tracking-widest mb-4 border-b pb-2">–ó–æ–Ω–∞ –†–æ—Å—Ç–∞</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8">
                        <!-- Jar: Savings -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-save" class="liquid liquid-growth"></div>
                            </div>
                            <div id="slider-save" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</div>
                            <div class="text-xs text-stone-500" id="val-save">$0</div>
                        </div>

                        <!-- Jar: Invest -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-invest" class="liquid liquid-growth"></div>
                            </div>
                            <div id="slider-invest" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
                            <div class="text-xs text-stone-500" id="val-invest">$0</div>
                        </div>

                        <!-- Jar: Education -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-edu" class="liquid liquid-growth"></div>
                            </div>
                            <div id="slider-edu" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–û–±—É—á–µ–Ω–∏–µ</div>
                            <div class="text-xs text-stone-500" id="val-edu">$0</div>
                        </div>
                    </div>
                </div>

                <!-- Group 3: Risky Business -->
                <div class="glass-panel rounded-xl p-5 mb-4">
                    <h3 class="text-sm font-bold text-purple-500 uppercase tracking-widest mb-4 border-b pb-2">–†–∏—Å–∫ –∏ –ë–∏–∑–Ω–µ—Å</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8">
                        <!-- Jar: Speculation -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-spec" class="liquid liquid-risk"></div>
                            </div>
                            <div id="slider-spec" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–°–ø–µ–∫—É–ª—è—Ü–∏–∏</div>
                            <div class="text-xs text-stone-500" id="val-spec">$0</div>
                        </div>

                        <!-- Jar: Business -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-business" class="liquid liquid-risk"></div>
                            </div>
                            <div id="slider-business" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–ë–∏–∑–Ω–µ—Å</div>
                            <div class="text-xs text-stone-500" id="val-business">$0</div>
                        </div>

                        <!-- Jar: Freelance -->
                        <div class="text-center relative">
                            <div class="jar-container">
                                <div id="fill-freelance" class="liquid liquid-risk" style="background:linear-gradient(to top, #64748b, #94a3b8)"></div>
                            </div>
                            <div id="slider-freelance" class="h-32 absolute top-[4px] right-[-10px] opacity-70 hover:opacity-100 transition-opacity"></div>
                            <div class="mt-2 font-bold text-sm">–§—Ä–∏–ª–∞–Ω—Å</div>
                            <div class="text-xs text-stone-500" id="val-freelance">$0</div>
                        </div>
                    </div>
                </div>

                <!-- ACTION BUTTON -->
                <div class="flex justify-center mt-8 pb-12">
                    <button id="btn-next-turn" onclick="game.nextTurn()" 
                        class="btn-pulse bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-xl py-4 px-12 rounded-full shadow-lg transform transition-transform active:scale-95 flex items-center gap-2">
                        <span>–°–¥–µ–ª–∞—Ç—å –•–æ–¥ (–ú–µ—Å—è—Ü)</span>
                        <span class="text-2xl">‚ñ∂</span>
                    </button>
                </div>
            </div>

            <!-- COLUMN 2: ANALYTICS (Right Side) - Spans 4 cols -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Chart Section -->
                <div class="glass-panel p-4 rounded-xl">
                    <h4 class="font-bold text-sm text-stone-500 mb-2 uppercase">–î–∏–Ω–∞–º–∏–∫–∞ –ö–∞–ø–∏—Ç–∞–ª–∞</h4>
                    <div class="chart-wrapper">
                        <canvas id="wealthChart"></canvas>
                    </div>
                    <div class="mt-2 text-xs text-stone-400 text-center">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è + –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
                </div>

                <!-- Event Log / Notifications -->
                <div class="glass-panel p-4 rounded-xl h-64 flex flex-col">
                    <h4 class="font-bold text-sm text-stone-500 mb-2 uppercase">–ñ—É—Ä–Ω–∞–ª –°–æ–±—ã—Ç–∏–π</h4>
                    <div id="event-log" class="flex-grow overflow-y-auto space-y-2 text-sm pr-1 custom-scrollbar">
                        <div class="text-stone-400 italic text-center mt-10">–°–æ–±—ã—Ç–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
                    </div>
                </div>

                <!-- Accumulators (Total values) -->
                <div class="glass-panel p-4 rounded-xl space-y-3">
                    <div class="flex justify-between items-center border-b pb-2">
                        <span class="text-stone-600">üè¶ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</span>
                        <span id="stat-savings" class="font-bold text-emerald-600">$0</span>
                    </div>
                    <div class="flex justify-between items-center border-b pb-2">
                        <span class="text-stone-600">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</span>
                        <span id="stat-invest" class="font-bold text-emerald-600">$0</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-stone-600">üé¢ –°–ø–µ–∫—É–ª—è—Ü–∏–∏</span>
                        <span id="stat-spec" class="font-bold text-purple-600">$0</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full text-center m-4">
            <div class="text-6xl mb-4" id="modal-icon">üèÜ</div>
            <h2 class="text-2xl font-bold mb-2" id="modal-title">Title</h2>
            <p class="text-stone-600 mb-6" id="modal-text">Message content goes here.</p>
            <button onclick="document.getElementById('modal-overlay').classList.add('hidden'); if(game.isGameOver) location.reload();" 
                class="bg-stone-800 text-white px-6 py-2 rounded-lg hover:bg-stone-700 transition-colors">
                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- Notification Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div>

    <script>
        // --- GAME CONFIG & DATA ---
        const CONFIG = {
            jars: [
                { id: 'survival', name: '–í—ã–∂–∏–≤–∞–Ω–∏–µ', min: 0, max: 2000, color: '#f59e0b' },
                { id: 'comfort', name: '–ö–æ–º—Ñ–æ—Ä—Ç', min: 0, max: 2000, color: '#f59e0b' },
                { id: 'save', name: '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è', min: 0, max: 2000, color: '#059669' },
                { id: 'invest', name: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', min: 0, max: 2000, color: '#059669' },
                { id: 'edu', name: '–û–±—É—á–µ–Ω–∏–µ', min: 0, max: 2000, color: '#059669' },
                { id: 'healthSpend', name: '–ó–¥–æ—Ä–æ–≤—å–µ (–†–∞—Å—Ö–æ–¥—ã)', min: 0, max: 1000, color: '#f43f5e' },
                { id: 'spec', name: '–°–ø–µ–∫—É–ª—è—Ü–∏–∏', min: 0, max: 2000, color: '#7c3aed' },
                { id: 'business', name: '–ë–∏–∑–Ω–µ—Å', min: 0, max: 2000, color: '#7c3aed' },
                { id: 'freelance', name: '–§—Ä–∏–ª–∞–Ω—Å (–£—Å–∏–ª–∏—è)', min: 0, max: 2000, color: '#64748b' }
            ],
            baseIncome: 1000,
            thresholds: {
                survivalSafe: 500,
                comfortSafe: 300
            }
        };

        const ROLES = {
            Saver: { goalText: '–ü–æ–¥—É—à–∫–∞ (3 –º–µ—Å)', goalCheck: (s) => s.savings >= (s.expenses*3), bonus: 0 },
            Investor: { goalText: '–ü–∞—Å—Å–∏–≤ $1000', goalCheck: (s) => s.passive >= 1000, bonus: 1000 },
            Spec: { goalText: '–ö–∞–ø–∏—Ç–∞–ª $10k', goalCheck: (s) => (s.savings + s.invest + s.spec) >= 10000, bonus: 0 }
        };

        // --- CHART SETUP ---
        let wealthChartInstance = null;

        function initChart() {
            const ctx = document.getElementById('wealthChart').getContext('2d');
            wealthChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '–ö–∞–ø–∏—Ç–∞–ª',
                        data: [],
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { 
                            beginAtZero: true,
                            grid: { color: '#e7e5e4' }
                        }
                    }
                }
            });
        }

        // --- GAME LOGIC CLASS ---
        class Game {
            constructor() {
                this.role = null;
                this.turn = 0;
                this.state = {
                    health: 100,
                    happiness: 100,
                    savings: 0,
                    invest: 0,
                    spec: 0,
                    business: 0,
                    salaryBonus: 0
                };
                this.inputs = {}; // Holds current slider values
                this.autoSave = true;
                this.isGameOver = false;

                // Bind slider inputs
                CONFIG.jars.forEach(jar => {
                    this.inputs[jar.id] = 0;
                });
            }

            init(roleKey, autoSave) {
                this.role = roleKey;
                this.autoSave = autoSave;
                this.state.savings = ROLES[roleKey].bonus;
                
                // Defaults
                this.inputs.survival = 500;
                this.inputs.comfort = 500;

                // Update UI to Game Mode
                document.getElementById('screen-intro').classList.add('hidden');
                document.getElementById('screen-game').classList.remove('hidden');
                document.getElementById('screen-game').classList.add('flex');
                
                document.getElementById('ui-goal-hint').textContent = `–¶–µ–ª—å: ${ROLES[roleKey].goalText}`;
                
                this.setupSliders();
                initChart();
                this.updateUI();
                this.showToast("–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –±—é–¥–∂–µ—Ç.", "info");
            }

            setupSliders() {
                CONFIG.jars.forEach(jar => {
                    const slider = document.getElementById(`slider-${jar.id}`);
                    const startVal = this.inputs[jar.id] || 0;
                    
                    noUiSlider.create(slider, {
                        start: startVal,
                        connect: [false, true], // Fill from bottom
                        direction: 'rtl', // Vertical bottom-to-top
                        orientation: 'vertical',
                        range: { 'min': jar.min, 'max': jar.max },
                        step: 10
                    });

                    // Reactivity
                    slider.noUiSlider.on('update', (values) => {
                        const val = parseInt(values[0]);
                        this.inputs[jar.id] = val;
                        
                        // Update Visuals
                        document.getElementById(`val-${jar.id}`).textContent = `$${val}`;
                        const fillPercent = (val / jar.max) * 100;
                        document.getElementById(`fill-${jar.id}`).style.height = `${fillPercent}%`;

                        this.recalcBudget();
                    });
                });
            }

            recalcBudget() {
                // Calculate Income
                const passive = (this.state.invest * 0.05 + this.state.savings * 0.03) / 12;
                // Business Income (Simple logic for UI responsiveness)
                const bizIncomeEstimate = this.state.business > 1000 ? this.state.business * 0.05 : 0; 
                const freelanceIncome = this.inputs.freelance; // $1 for $1 effort visual
                
                const totalIncome = CONFIG.baseIncome + this.state.salaryBonus + passive + freelanceIncome + bizIncomeEstimate;
                
                // Calculate Expense
                let totalExpense = 0;
                CONFIG.jars.forEach(jar => {
                    if(jar.id !== 'freelance') { // Freelance is effort, not expense
                         totalExpense += this.inputs[jar.id];
                    }
                });

                const free = totalIncome - totalExpense;

                // Update UI Numbers
                document.getElementById('ui-income-total').textContent = `$${Math.round(totalIncome)}`;
                document.getElementById('ui-expenses-total').textContent = `$${Math.round(totalExpense)}`;
                document.getElementById('ui-free-money').textContent = `$${Math.round(free)}`;
                document.getElementById('ui-passive-income').textContent = `+$${Math.round(passive)}/–º–µ—Å`;
                document.getElementById('ui-total-wealth').textContent = `$${Math.round(this.state.savings + this.state.invest + this.state.spec)}`;

                // Style Free Money
                const freeCard = document.getElementById('ui-free-money-card');
                if(free < 0) {
                    freeCard.classList.add('border-rose-500', 'bg-rose-50');
                    freeCard.classList.remove('border-emerald-500', 'bg-emerald-50');
                } else {
                    freeCard.classList.remove('border-rose-500', 'bg-rose-50');
                    freeCard.classList.add('border-emerald-500', 'bg-emerald-50');
                }

                // Auto-save visual cue (if enabled and positive)
                if(this.autoSave && free > 0) {
                     // Note: We don't move slider automatically here to avoid loop, 
                     // but we calculate it in logic.
                }

                return { totalIncome, totalExpense, free, passive };
            }

            nextTurn() {
                if(this.isGameOver) return;

                const budget = this.recalcBudget();
                
                // 1. Logic: Health & Happy Impact
                // Survival check
                if(this.inputs.survival < CONFIG.thresholds.survivalSafe) {
                    this.state.health -= 10;
                    this.state.happiness -= 5;
                    this.logEvent("üìâ –°–∫—É–¥–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ: -10 –ó–¥–æ—Ä–æ–≤—å—è");
                }
                // Comfort check
                if(this.inputs.comfort < CONFIG.thresholds.comfortSafe) {
                    this.state.happiness -= 8;
                    this.logEvent("üìâ –î–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç: -8 –°—á–∞—Å—Ç—å—è");
                }
                // Health Spend
                if(this.inputs.healthSpend > 0) {
                    this.state.health += (this.inputs.healthSpend / 100) * 2;
                }
                // Freelance Burnout
                if(this.inputs.freelance > 0) {
                    const burnout = Math.ceil(this.inputs.freelance / 200);
                    this.state.happiness -= burnout;
                    this.state.health -= Math.ceil(burnout/2);
                }

                // 2. Financial Logic
                let actualFree = budget.free;
                
                // Education ROI
                if(this.inputs.edu > 0) {
                    const raise = this.inputs.edu * 0.1;
                    this.state.salaryBonus += raise;
                    this.logEvent(`üéì –û–±—É—á–µ–Ω–∏–µ: –ó–∞—Ä–ø–ª–∞—Ç–∞ +$${Math.round(raise)}`);
                }

                // Speculation (Randomness)
                if(this.inputs.spec > 0 || this.state.spec > 0) {
                    this.state.spec += this.inputs.spec;
                    const luck = Math.random();
                    let multiplier = 1;
                    if(luck > 0.6) multiplier = 1.1; // +10%
                    else if (luck < 0.3) multiplier = 0.9; // -10%
                    
                    const oldSpec = this.state.spec;
                    this.state.spec *= multiplier;
                    const diff = this.state.spec - oldSpec;
                    if(Math.abs(diff) > 1) this.logEvent(diff > 0 ? `üöÄ –°–ø–µ–∫—É–ª—è—Ü–∏–∏: +$${Math.round(diff)}` : `üìâ –°–ø–µ–∫—É–ª—è—Ü–∏–∏: -$${Math.round(Math.abs(diff))}`);
                }

                // Business Logic
                if(this.inputs.business > 0 || this.state.business > 0) {
                    this.state.business += this.inputs.business;
                    // Business return is added to income in next recalc, stored in state implicitly
                }

                // Auto Save Logic
                if(this.autoSave && actualFree > 0) {
                    this.state.savings += actualFree;
                    actualFree = 0;
                    this.showToast("üí∞ –û—Å—Ç–∞—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è", "success");
                }
                
                // Base Growth
                this.state.savings += (this.inputs.save + actualFree); // Add plan + remaining
                this.state.invest += this.inputs.invest;
                
                // Compound Interest
                this.state.savings *= 1.0025; // ~3% APY
                this.state.invest *= 1.0042; // ~5% APY

                // 3. Random Events (Risk)
                if(Math.random() < 0.15) {
                    const events = [
                        { text: "ü¶∑ –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥", cost: 200, type: 'expense' },
                        { text: "ü§ï –ü—Ä–æ—Å—Ç—É–¥–∞", health: -5, type: 'health' },
                        { text: "üéâ –ü—Ä–µ–º–∏—è", bonus: 300, type: 'income' }
                    ];
                    const evt = events[Math.floor(Math.random()*events.length)];
                    this.logEvent(`üé≤ –°–æ–±—ã—Ç–∏–µ: ${evt.text}`);
                    
                    if(evt.type === 'expense') this.state.savings -= evt.cost;
                    if(evt.type === 'health') this.state.health += evt.health;
                    if(evt.type === 'income') this.state.savings += evt.bonus;
                }

                // Cap stats
                this.state.health = Math.min(100, Math.max(0, this.state.health));
                this.state.happiness = Math.min(100, Math.max(0, this.state.happiness));

                // 4. Update Game State
                this.turn++;
                this.updateUI();
                
                // Check Win/Loss
                this.checkGameState(budget.passive);
            }

            checkGameState(passiveIncome) {
                // Loss
                if(this.state.health <= 0) this.gameOver("–í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ. –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.", "üíÄ");
                if(this.state.happiness <= 0) this.gameOver("–î–µ–ø—Ä–µ—Å—Å–∏—è –ø–æ–≥–ª–æ—Ç–∏–ª–∞ –≤–∞—Å. –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.", "üò¢");

                // Win Conditions based on Role
                const currentStats = { 
                    savings: this.state.savings, 
                    expenses: (this.inputs.survival + this.inputs.comfort),
                    passive: passiveIncome,
                    invest: this.state.invest,
                    spec: this.state.spec
                };
                
                // Goal Progress Bar Calc
                let progress = 0;
                if(this.role === 'Saver') progress = (currentStats.savings / (currentStats.expenses * 3)) * 100;
                if(this.role === 'Investor') progress = (passiveIncome / 1000) * 100;
                if(this.role === 'Spec') progress = ((this.state.savings + this.state.invest + this.state.spec) / 10000) * 100;

                document.getElementById('bar-goal').style.width = `${Math.min(100, Math.max(0, progress))}%`;

                if(ROLES[this.role].goalCheck(currentStats)) {
                    this.gameOver("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!", "üèÜ");
                }
            }

            gameOver(msg, icon) {
                this.isGameOver = true;
                document.getElementById('modal-title').textContent = this.state.health <=0 || this.state.happiness <=0 ? "Game Over" : "–ü–æ–±–µ–¥–∞!";
                document.getElementById('modal-text').textContent = msg;
                document.getElementById('modal-icon').textContent = icon;
                document.getElementById('modal-overlay').classList.remove('hidden');
            }

            updateUI() {
                // Vitals
                document.getElementById('bar-health').style.width = `${this.state.health}%`;
                document.getElementById('txt-health').textContent = `${Math.round(this.state.health)}%`;
                document.getElementById('bar-happy').style.width = `${this.state.happiness}%`;
                document.getElementById('txt-happy').textContent = `${Math.round(this.state.happiness)}%`;
                document.getElementById('ui-turn').textContent = this.turn;

                // Accumulators
                document.getElementById('stat-savings').textContent = `$${Math.round(this.state.savings)}`;
                document.getElementById('stat-invest').textContent = `$${Math.round(this.state.invest)}`;
                document.getElementById('stat-spec').textContent = `$${Math.round(this.state.spec)}`;

                // Chart Update
                const totalWealth = this.state.savings + this.state.invest + this.state.spec;
                wealthChartInstance.data.labels.push(this.turn);
                wealthChartInstance.data.datasets[0].data.push(totalWealth);
                wealthChartInstance.update();

                // Recalc budget once more to ensure Free money is accurate after events
                this.recalcBudget();
            }

            logEvent(msg) {
                const log = document.getElementById('event-log');
                const div = document.createElement('div');
                div.className = "p-2 bg-stone-50 rounded border-l-2 border-stone-300 text-xs animate-pulse";
                div.innerHTML = `<span class="font-bold mr-1">[–•–æ–¥ ${this.turn}]</span> ${msg}`;
                log.prepend(div);
                
                // Cleanup old logs
                if(log.children.length > 20) log.lastChild.remove();
            }

            showToast(msg, type='info') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                let colorClass = type === 'success' ? 'bg-emerald-600' : (type === 'error' ? 'bg-rose-600' : 'bg-stone-800');
                
                toast.className = `${colorClass} text-white px-4 py-3 rounded shadow-lg text-sm font-bold toast-enter flex items-center gap-2`;
                toast.innerHTML = msg;
                
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        }

        // --- INIT ---
        const game = new Game();

        window.selectRole = (role) => {
            const auto = document.getElementById('intro-auto-save').checked;
            game.init(role, auto);
        };

        // Prevent layout shift on mobile input
        window.addEventListener('resize', () => {
            if(wealthChartInstance) wealthChartInstance.resize();
        });

    </script>
</body>
</html>
```
