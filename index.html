<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>5 –ö—É–≤—à–∏–Ω–æ–≤</title>

  <!-- Tailwind & Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- noUiSlider 15.8.1 -->
  <link  href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.8.1/nouislider.min.js"></script>

  <!-- –ö—É–≤—à–∏–Ω—ã -->
  <style>
    .jar-wrap {width:120px; display:flex; flex-direction:column; align-items:center;}
    .jar      {width:80px; height:160px; border:4px solid #555; border-radius:8px 8px 32px 32px;
               position:relative; background:#fff; overflow:hidden;}
    .liquid   {position:absolute; bottom:0; left:0; width:100%; height:0;
               background:linear-gradient(#4ade80,#16a34a); transition:height .25s;}
    .slider-v {height:160px; margin-top:12px;}
    input.hidden-field{display:none;}
  </style>
</head>

<body class="bg-gray-100">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –°–¢–ê–†–¢ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="start-screen" class="min-h-screen flex flex-col items-center justify-center p-6">
  <h1 class="text-4xl font-bold mb-6 text-center">üè∫ 5 –ö—É–≤—à–∏–Ω–æ–≤</h1>
  <div class="bg-white p-6 rounded shadow w-full max-w-sm space-y-4 text-center">
    <h2 class="text-xl font-semibold mb-2">–í—ã–±–µ—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã:</h2>
    <button onclick="startGame(24)" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700">24 –º–µ—Å—è—Ü–∞</button>
    <button onclick="startGame(36)" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">36 –º–µ—Å—è—Ü–µ–≤</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –ò–ì–†–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="game-screen" class="hidden p-6 space-y-6 max-w-5xl mx-auto">

  <!-- –î–æ—Ö–æ–¥ / –†–∞—Å—Ö–æ–¥—ã -->
  <div class="grid grid-cols-2 gap-6">
    <div>
      <label class="block font-semibold mb-1">–î–æ—Ö–æ–¥ ($)</label>
      <p id="incomeDisplay" class="w-full border p-2 rounded bg-gray-50">$0</p>
    </div>
    <div>
      <label class="block font-semibold mb-1">–†–∞—Å—Ö–æ–¥—ã ($)</label>
      <p id="expensesDisplay" class="w-full border p-2 rounded bg-gray-50">$0</p>
    </div>
  </div>

  <!-- –ö—É–≤—à–∏–Ω—ã -->
  <div id="jars" class="flex flex-wrap gap-6 mb-8">

    <!-- 1. –í—ã–∂–∏–≤–∞–Ω–∏–µ -->
    <div class="jar-wrap">
      <div class="jar"><div id="survivalFill" class="liquid"></div></div>
      <div id="survivalSlider" class="slider-v"></div>
      <p class="mt-1 text-center font-semibold">
        –í—ã–∂–∏–≤–∞–Ω–∏–µ<br><span id="survivalVal">500</span> $
      </p>
      <input id="survival" type="hidden" class="hidden-field" value="500">
    </div>

    <!-- 2. –ö–æ–º—Ñ–æ—Ä—Ç -->
    <div class="jar-wrap">
      <div class="jar"><div id="comfortFill" class="liquid"></div></div>
      <div id="comfortSlider" class="slider-v"></div>
      <p class="mt-1 text-center font-semibold">
        –ö–æ–º—Ñ–æ—Ä—Ç<br><span id="comfortVal">500</span> $
      </p>
      <input id="comfort" type="hidden" class="hidden-field" value="500">
    </div>

    <!-- 3. –°–±–µ—Ä–µ–∂–µ–Ω–∏—è -->
    <div class="jar-wrap">
      <div class="jar"><div id="saveFill" class="liquid"></div></div>
      <div id="saveSlider" class="slider-v"></div>
      <p class="mt-1 text-center font-semibold">
        –°–±–µ—Ä–µ–∂–µ–Ω–∏—è<br><span id="saveVal">0</span> $
      </p>
      <input id="save" type="hidden" class="hidden-field" value="0">
    </div>

    <!-- 4. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ -->
    <div class="jar-wrap">
      <div class="jar"><div id="investFill" class="liquid"></div></div>
      <div id="investSlider" class="slider-v"></div>
      <p class="mt-1 text-center font-semibold">
        –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏<br><span id="investVal">0</span> $
      </p>
      <input id="invest" type="hidden" class="hidden-field" value="0">
    </div>
  </div>

  <!-- –ü—Ä–æ—á–∏–µ –ø–æ–ª—è -->
  <div class="grid grid-cols-2 gap-6">
    <div>
      <label for="healthSpend" class="block font-semibold mb-1">–ù–∞ –∑–¥–æ—Ä–æ–≤—å–µ ($)</label>
      <input id="healthSpend" type="number" class="w-full border p-2 rounded" value="0">
    </div>
    <div>
      <label for="edu" class="block font-semibold mb-1">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ($)</label>
      <input id="edu" type="number" class="w-full border p-2 rounded" value="0">
    </div>
    <div class="col-span-2">
      <label for="extra" class="block font-semibold mb-1">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</label>
      <select id="extra" class="w-full border p-2 rounded">
        <option value="–Ω–µ—Ç">–ù–µ—Ç</option>
        <option value="–¥–∞">–î–∞</option>
      </select>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —Ö–æ–¥–∞ -->
  <button onclick="runTurn()" class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ö–æ–¥</button>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="text-center space-y-2">
    <p>–•–æ–¥: <span id="turn">0</span> / <span id="maxTurns">0</span></p>
    <p>–°–æ–±—ã—Ç–∏–µ: <span id="event">-</span></p>
    <p>–°–≤–æ–±–æ–¥–Ω—ã–µ –¥–µ–Ω—å–≥–∏: <span id="free">$0</span></p>
    <p>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è: <span id="savings">$0</span></p>
    <p>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: <span id="investments">$0</span></p>

    <p>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="healthResult">100%</span></p>
    <div class="w-full h-3 bg-gray-300 rounded-full">
      <div id="healthBar" class="h-3 bg-green-500 rounded-full" style="width:100%"></div>
    </div>

    <p class="mt-2">–°—á–∞—Å—Ç—å–µ: <span id="happinessResult">90%</span></p>
    <div class="w-full h-3 bg-gray-300 rounded-full">
      <div id="happinessBar" class="h-3 bg-yellow-400 rounded-full" style="width:90%"></div>
    </div>
  </div>

  <!-- –ò—Å—Ç–æ—Ä–∏—è -->
  <div class="mt-8">
    <h2 class="text-xl font-bold text-center mb-2">üìò –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h2>
    <table class="w-full text-sm bg-white rounded shadow overflow-hidden">
      <thead class="bg-gray-200 font-bold">
      <tr>
        <th class="p-2">–•–æ–¥</th><th class="p-2">–°–æ–±—ã—Ç–∏–µ</th><th class="p-2">–°–≤–æ–±–æ–¥–Ω—ã–µ $</th>
        <th class="p-2">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</th><th class="p-2">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</th>
        <th class="p-2">–ó–¥–æ—Ä–æ–≤—å–µ</th><th class="p-2">–°—á–∞—Å—Ç—å–µ</th>
      </tr>
      </thead>
      <tbody id="historyTable" class="text-center"></tbody>
    </table>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ -->
  <div class="mt-8">
    <h2 class="text-xl font-bold text-center mb-2">üìà –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <canvas id="scoreChart"></canvas>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –§–ò–ù–ò–® ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="end-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-6 text-center">
  <h1 class="text-4xl font-bold mb-6">üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h1>
  <div class="bg-white p-6 rounded shadow w-full max-w-md space-y-4">
    <p id="endReason"></p>
    <p><strong>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è:</strong> <span id="finalSavings">$0</span></p>
    <p><strong>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</strong> <span id="finalInvestments">$0</span></p>
    <p><strong>–ó–¥–æ—Ä–æ–≤—å–µ:</strong> <span id="finalHealth">0%</span></p>
    <p><strong>–°—á–∞—Å—Ç—å–µ:</strong> <span id="finalHappiness">0%</span></p>
    <p><strong>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</strong> <span id="finalPassiveIncome">$0</span></p>
    <p><strong>–ë–∞–ª–ª—ã:</strong> <span id="finalScore">0</span></p>
    <p><strong>–¢–∏—Ç—É–ª:</strong> <span id="finalTitle">-</span></p>
    <button onclick="location.reload()" class="mt-4 bg-green-600 text-white p-2 rounded hover:bg-green-700">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê –°–ö–†–ò–ü–¢ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
document.addEventListener('DOMContentLoaded', ()=>{

  let turn=0, maxTurns=0;
  let savings=0, investments=0;
  let health=100, happiness=90;
  const scores=[];

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –≥—Ä–∞—Ñ–∏–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const ctx=document.getElementById('scoreChart').getContext('2d');
  const chart=new Chart(ctx,{type:'line',
    data:{labels:[],datasets:[{label:'–ë–∞–ª–ª—ã',data:[],borderColor:'rgb(75,192,192)',tension:0.3,fill:false}]},
    options:{scales:{y:{beginAtZero:true}}}
  });

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ø–µ—Ä–µ—Å—á—ë—Ç –¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateIncomeExpenses(){
    const survival =+document.getElementById('survival').value;
    const comfort  =+document.getElementById('comfort').value;
    const save     =+document.getElementById('save').value;
    const invest   =+document.getElementById('invest').value;
    const healthSp =+document.getElementById('healthSpend').value;
    const edu      =+document.getElementById('edu').value;
    const extra    = document.getElementById('extra').value;

    let income=1000; if(extra==='–¥–∞') income+=200;
    const spend=survival+comfort+save+invest+healthSp+edu;

    document.getElementById('incomeDisplay').innerText   = `$${income}`;
    document.getElementById('expensesDisplay').innerText = `$${spend}`;
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –±–∏–ª–¥ –∫—É–≤—à–∏–Ω–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function buildJar(sliderId, fillId, valueSpan, hiddenId, max){
    const slider=document.getElementById(sliderId);
    const fill  =document.getElementById(fillId);
    const valEl =document.getElementById(valueSpan);
    const hidden=document.getElementById(hiddenId);

    noUiSlider.create(slider,{
      start:+hidden.value,
      orientation:'vertical',
      direction:'rtl',
      step:10,
      connect:[true,false],
      range:{min:0,max:max}
    });

    slider.noUiSlider.on('update', v=>{
      const num=Math.round(v[0]);
      fill.style.height=(num/max*100)+'%';
      valEl.textContent=num;
      hidden.value=num;
      updateIncomeExpenses();
    });
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—É–≤—à–∏–Ω—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  buildJar('survivalSlider','survivalFill','survivalVal','survival',2000);
  buildJar('comfortSlider' ,'comfortFill' ,'comfortVal' ,'comfort' ,2000);
  buildJar('saveSlider'    ,'saveFill'    ,'saveVal'    ,'save'    ,2000);
  buildJar('investSlider'  ,'investFill'  ,'investVal'  ,'invest'  ,2000);

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateBars(){
    document.getElementById('healthBar').style.width    = `${health}%`;
    document.getElementById('happinessBar').style.width = `${happiness}%`;
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –∏—Å—Ç–æ—Ä–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateHistory(event,free){
    const row=document.createElement('tr');
    row.innerHTML=`
      <td class="p-2">${turn}</td><td class="p-2">${event}</td>
      <td class="p-2">$${Math.round(free)}</td>
      <td class="p-2">$${Math.round(savings)}</td>
      <td class="p-2">$${Math.round(investments)}</td>
      <td class="p-2">${health}%</td><td class="p-2">${happiness}%</td>`;
    document.getElementById('historyTable').appendChild(row);
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –≥—Ä–∞—Ñ–∏–∫ –±–∞–ª–ª–æ–≤ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateChart(){
    let score=Math.floor(savings/1000)+Math.floor(investments/1000)*2;
    if(health>70) score+=20;
    if(happiness>70) score+=20;
    const passive=(investments*0.05+savings*0.03)/12;
    if(passive>1000) score+=30;
    scores.push(score);
    chart.data.labels.push(turn);
    chart.data.datasets[0].data.push(score);
    chart.update();
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function finishGame(reason){
    document.getElementById('game-screen').classList.add('hidden');
    const end=document.getElementById('end-screen');
    end.classList.remove('hidden');
    document.getElementById('endReason').innerText = reason;
    document.getElementById('finalSavings').innerText     = `$${Math.round(savings)}`;
    document.getElementById('finalInvestments').innerText = `$${Math.round(investments)}`;
    document.getElementById('finalHealth').innerText      = `${health}%`;
    document.getElementById('finalHappiness').innerText   = `${happiness}%`;
    document.getElementById('finalPassiveIncome').innerText = `$${Math.round((investments*0.05+savings*0.03)/12)}`;
    const finalScore=scores[scores.length-1];
    document.getElementById('finalScore').innerText=finalScore+' –±–∞–ª–ª–æ–≤';
    let title='–ù–æ–≤–∏—á–æ–∫';
    if(finalScore>=80) title='–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–∞–≥–Ω–∞—Ç';
    else if(health>90) title='–ó–¥–æ—Ä–æ–≤—è–∫';
    else if(happiness>90) title='–°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫';
    else if(health<30)   title='–í—ã–∂–∏–≤—à–∏–π';
    document.getElementById('finalTitle').innerText=title;
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  window.startGame=turns=>{
    maxTurns=turns;
    document.getElementById('maxTurns').innerText=turns;
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    updateIncomeExpenses();
    updateBars();
  };

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —Ö–æ–¥ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  window.runTurn=()=>{
    turn++;
    updateIncomeExpenses();

    const survival =+document.getElementById('survival').value;
    const comfort  =+document.getElementById('comfort').value;
    const save     =+document.getElementById('save').value;
    const invest   =+document.getElementById('invest').value;
    const healthSp =+document.getElementById('healthSpend').value;
    const edu      =+document.getElementById('edu').value;
    const extra    = document.getElementById('extra').value;

    let income=1000; if(extra==='–¥–∞') income+=200;
    const spend=survival+comfort+save+invest+healthSp+edu;

    // —Å–æ–±—ã—Ç–∏–µ
    let event='–Ω–∏—á–µ–≥–æ', penalty=0, crisis=0;
    const r=Math.random();
    if(r<0.15){event='–º–µ–ª–∫–∞—è —Ç—Ä–∞—Ç–∞ ‚Äì $50'; penalty=-50;}
    else if(r<0.25){event='–∫—Ä–∏–∑–∏—Å ‚Äì 6 % –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π'; crisis=investments*0.06;}
    else if(r<0.40){event='–±–æ–ª–µ–∑–Ω—å ‚Äì 5 –∑–¥–æ—Ä–æ–≤—å—è'; health=Math.max(0,health-5);}

    const free=income-spend+penalty;
    savings+=save+free;
    const growth=Math.random()<=0.7?Math.random()*0.03:Math.random()*-0.01;
    investments=(investments+invest-crisis)*(1+growth);

    if(event!=='–±–æ–ª–µ–∑–Ω—å ‚Äì 5 –∑–¥–æ—Ä–æ–≤—å—è'){
      if(survival<500) health-=((500-survival)/500)*100;
      else             health+=5;
      if(happiness>=90) health+=5;
      health+= (healthSp/500)*50;
    }
    health=Math.round(Math.max(0,Math.min(100,health)));

    if(extra==='–¥–∞')   health=Math.max(0,health-5);
    if(comfort<500)    happiness-=((500-comfort)/500)*10;
    if(extra==='–¥–∞')   happiness-=5;
    happiness=Math.round(Math.max(0,happiness));

    // UI
    document.getElementById('turn').innerText=turn;
    document.getElementById('event').innerText=event;
    document.getElementById('free').innerText          = `$${Math.round(free)}`;
    document.getElementById('savings').innerText       = `$${Math.round(savings)}`;
    document.getElementById('investments').innerText   = `$${Math.round(investments)}`;
    document.getElementById('healthResult').innerText  = `${health}%`;
    document.getElementById('happinessResult').innerText=`${happiness}%`;

    updateBars();
    updateHistory(event,free);
    updateChart();

    if(health<=0||happiness<=0||turn>=maxTurns){
      const reason=health<=0?'–¢—ã –ø–æ—Ç–µ—Ä—è–ª –∑–¥–æ—Ä–æ–≤—å–µ.' : happiness<=0?'–¢—ã –ø–æ—Ç–µ—Ä—è–ª —Å—á–∞—Å—Ç—å–µ.' : '–•–æ–¥—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å.';
      finishGame(reason);
    }
  };

  /* –Ω–∞—á–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  updateIncomeExpenses();
});
</script>
</body>
</html>
