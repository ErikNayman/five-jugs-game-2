<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>5 –ö—É–≤—à–∏–Ω–æ–≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">

  <!-- ========== –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù ========== -->
  <div id="start-screen" class="min-h-screen flex flex-col items-center justify-center p-6">
    <h1 class="text-4xl font-bold mb-6 text-center">üè∫ 5 –ö—É–≤—à–∏–Ω–æ–≤</h1>
    <div class="bg-white p-6 rounded shadow w-full max-w-sm space-y-4 text-center">
      <h2 class="text-xl font-semibold mb-2">–í—ã–±–µ—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã:</h2>
      <button onclick="startGame(24)" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700">24 –º–µ—Å—è—Ü–∞</button>
      <button onclick="startGame(36)" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">36 –º–µ—Å—è—Ü–µ–≤</button>
    </div>
  </div>

  <!-- ========== –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ========== -->
  <div id="game-screen" class="hidden p-6 space-y-6 max-w-5xl mx-auto">

    <!-- –í–≤–æ–¥ —Ç—Ä–∞—Ç -->
  <div class="grid grid-cols-2 gap-6">
    <div>
    <label class="block font-semibold mb-1">–î–æ—Ö–æ–¥ ($)</label>
    <p id="incomeDisplay" class="w-full border p-2 rounded bg-gray-50">$0</p>
  </div>
  <div>
    <label class="block font-semibold mb-1">–†–∞—Å—Ö–æ–¥—ã ($)</label>
    <p id="expensesDisplay" class="w-full border p-2 rounded bg-gray-50">$0</p>
  </div>
  </div>
    <div>
    <label for="survival" class="block font-semibold mb-1">–í—ã–∂–∏–≤–∞–Ω–∏–µ ($)</label>
    <input id="survival" type="number" class="w-full border p-2 rounded" value="500">
  </div>

  <div>
    <label for="comfort" class="block font-semibold mb-1">–ö–æ–º—Ñ–æ—Ä—Ç ($)</label>
    <input id="comfort" type="number" class="w-full border p-2 rounded" value="500">
  </div>

  <div>
    <label for="save" class="block font-semibold mb-1">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è ($)</label>
    <input id="save" type="number" class="w-full border p-2 rounded" value="0">
  </div>

  <div>
    <label for="invest" class="block font-semibold mb-1">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ ($)</label>
    <input id="invest" type="number" class="w-full border p-2 rounded" value="0">
  </div>

  <div>
    <label for="healthSpend" class="block font-semibold mb-1">–ù–∞ –∑–¥–æ—Ä–æ–≤—å–µ ($)</label>
    <input id="healthSpend" type="number" class="w-full border p-2 rounded" value="0">
  </div>

  <div>
    <label for="edu" class="block font-semibold mb-1">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ($)</label>
    <input id="edu" type="number" class="w-full border p-2 rounded" value="0">
  </div>

  <div class="col-span-2">
    <label for="extra" class="block font-semibold mb-1">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</label>
    <select id="extra" class="w-full border p-2 rounded">
      <option value="–Ω–µ—Ç">–ù–µ—Ç</option>
      <option value="–¥–∞">–î–∞</option>
    </select>
  </div>

</div>

    <!-- –ö–Ω–æ–ø–∫–∞ —Ö–æ–¥–∞ -->
    <button onclick="runTurn()" class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">
      –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ö–æ–¥
    </button>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="text-center space-y-2">
      <p>–•–æ–¥: <span id="turn">0</span> / <span id="maxTurns">0</span></p>
      <p>–°–æ–±—ã—Ç–∏–µ: <span id="event">-</span></p>
      <p>–°–≤–æ–±–æ–¥–Ω—ã–µ –¥–µ–Ω—å–≥–∏: <span id="free">$0</span></p>
      <p>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è: <span id="savings">$0</span></p>
      <p>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: <span id="investments">$0</span></p>

      <p>–ó–¥–æ—Ä–æ–≤—å–µ: <span id="healthResult">100%</span></p>
      <div class="w-full h-3 bg-gray-300 rounded-full">
        <div id="healthBar" class="h-3 bg-green-500 rounded-full" style="width:100%"></div>
      </div>

      <p class="mt-2">–°—á–∞—Å—Ç—å–µ: <span id="happinessResult">90%</span></p>
      <div class="w-full h-3 bg-gray-300 rounded-full">
        <div id="happinessBar" class="h-3 bg-yellow-400 rounded-full" style="width:90%"></div>
      </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤ -->
    <div class="mt-8">
      <h2 class="text-xl font-bold text-center mb-2">üìò –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h2>
      <table class="w-full text-sm bg-white rounded shadow overflow-hidden">
        <thead class="bg-gray-200 font-bold">
          <tr>
            <th class="p-2">–•–æ–¥</th>
            <th class="p-2">–°–æ–±—ã—Ç–∏–µ</th>
            <th class="p-2">–°–≤–æ–±–æ–¥–Ω—ã–µ $</th>
            <th class="p-2">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</th>
            <th class="p-2">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</th>
            <th class="p-2">–ó–¥–æ—Ä–æ–≤—å–µ</th>
            <th class="p-2">–°—á–∞—Å—Ç—å–µ</th>
          </tr>
        </thead>
        <tbody id="historyTable" class="text-center"></tbody>
      </table>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ –±–∞–ª–ª–æ–≤ -->
    <div class="mt-8">
      <h2 class="text-xl font-bold text-center mb-2">üìà –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h2>
      <canvas id="scoreChart"></canvas>
    </div>
  </div>

  <!-- ========== –≠–ö–†–ê–ù –ó–ê–í–ï–†–®–ï–ù–ò–Ø ========== -->
  <div id="end-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-6 text-center">
    <h1 class="text-4xl font-bold mb-6">üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h1>
    <div class="bg-white p-6 rounded shadow w-full max-w-md space-y-4">
      <p id="endReason"></p>
      <p><strong>–°–±–µ—Ä–µ–∂–µ–Ω–∏—è:</strong> <span id="finalSavings">$0</span></p>
      <p><strong>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</strong> <span id="finalInvestments">$0</span></p>
      <p><strong>–ó–¥–æ—Ä–æ–≤—å–µ:</strong> <span id="finalHealth">0%</span></p>
      <p><strong>–°—á–∞—Å—Ç—å–µ:</strong> <span id="finalHappiness">0%</span></p>
      <p><strong>–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</strong> <span id="finalPassiveIncome">$0</span></p>
      <p><strong>–ë–∞–ª–ª—ã:</strong> <span id="finalScore">0</span></p>
      <p><strong>–¢–∏—Ç—É–ª:</strong> <span id="finalTitle">-</span></p>
      <button onclick="location.reload()" class="mt-4 bg-green-600 text-white p-2 rounded hover:bg-green-700">
        –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
      </button>
    </div>
  </div>

  <!-- ========== –°–ö–†–ò–ü–¢ ========== -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    let turn = 0, maxTurns = 0;
    let savings = 0, investments = 0;
    let health = 100, happiness = 90;
    let scores = [];

    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫
    const ctx = document.getElementById('scoreChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: { labels: [], datasets: [{ label: '–ë–∞–ª–ª—ã', data: [], borderColor: 'rgb(75,192,192)', tension:0.3, fill:false }] },
      options: { scales: { y: { beginAtZero: true } } }
    });

    
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –î–æ—Ö–æ–¥—ã/–†–∞—Å—Ö–æ–¥—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateIncomeExpenses() {
    const survival    = +document.getElementById('survival').value;
    const comfort     = +document.getElementById('comfort').value;
    const save        = +document.getElementById('save').value;
    const invest      = +document.getElementById('invest').value;
    const healthSpend = +document.getElementById('healthSpend').value;
    const edu         = +document.getElementById('edu').value;
    const extra       = document.getElementById('extra').value;

    let income = 1000;
    if (extra === '–¥–∞') income += 200;

    const totalSpend = survival + comfort + save + invest + healthSpend + edu;

    document.getElementById('incomeDisplay').innerText   = `$${income}`;
    document.getElementById('expensesDisplay').innerText = `$${totalSpend}`;
  }

    
    window.startGame = (turns) => {
      maxTurns = turns;
      document.getElementById('maxTurns').innerText = turns;
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      updateIncomeExpenses();
      updateBars();
    };
    
      window.runTurn = () => {
    turn++;
      updateIncomeExpenses();
        
      // —á–∏—Ç–∞–µ–º –≤—Å–µ –ø–æ–ª—è
      const survival = +document.getElementById('survival').value;
      const comfort  = +document.getElementById('comfort').value;
      const save     = +document.getElementById('save').value;
      const invest   = +document.getElementById('invest').value;
      const healthSpend = +document.getElementById('healthSpend').value;
      const edu      = +document.getElementById('edu').value;
      const extra    = document.getElementById('extra').value;
    
      let income = 1000; if (extra==='–¥–∞') income += 200;
      const totalSpend = survival + comfort + save + invest + healthSpend + edu;

      // –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å–ø–ª–µ–∏
      document.getElementById('incomeDisplay').innerText   = `$${income}`;
      document.getElementById('expensesDisplay').innerText = `$${totalSpend}`;
       
      // —Å–æ–±—ã—Ç–∏–µ
      let event='–Ω–∏—á–µ–≥–æ', penalty=0, crisis=0;
      const r = Math.random();
      if(r<0.15){event='–º–µ–ª–∫–∞—è —Ç—Ä–∞—Ç–∞ ‚Äì$50'; penalty=-50;}
      else if(r<0.25){event='–∫—Ä–∏–∑–∏—Å ‚Äì6% –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π'; crisis=investments*0.06;}
      else if(r<0.40){event='–±–æ–ª–µ–∑–Ω—å ‚Äì5 –∑–¥–æ—Ä–æ–≤—å—è'; health=Math.max(0,health-5);}
      
      // —Ä–∞—Å—á—ë—Ç—ã
  
      const free = income - totalSpend + penalty;
      savings += save + free;
      const growth = Math.random()<=0.7 ? Math.random()*0.03 : Math.random()*-0.01;
      investments = (investments + invest - crisis)*(1+growth);

      if (event !== '–±–æ–ª–µ–∑–Ω—å ‚Äì5 –∑–¥–æ—Ä–æ–≤—å—è') {
      if (survival < 500)    health -= ((500 - survival)/500) * 100;
      else                   health += 5;
      if (happiness >= 90)   health += 5;
      health += (healthSpend/500) * 50;}

      health = Math.round(Math.max(0, Math.min(100, health)));

      if(extra==='–¥–∞') {health = Math.max(0, health - 5);}
      if(comfort<500) happiness -= ((500-comfort)/500)*10;
      if(extra==='–¥–∞') happiness -= 5;
      happiness = Math.round(Math.max(0, happiness));

      // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      document.getElementById('turn').innerText = turn;
      document.getElementById('event').innerText = event;
      document.getElementById('free').innerText = `$${Math.round(free)}`;
      document.getElementById('savings').innerText = `$${Math.round(savings)}`;
      document.getElementById('investments').innerText = `$${Math.round(investments)}`;
      document.getElementById('healthResult').innerText = `${health}%`;
      document.getElementById('happinessResult').innerText = `${happiness}%`;

      updateBars();
      updateHistory(event, free);
      updateChart();

      if(health<=0 || happiness<=0 || turn>=maxTurns){
        let reason = health<=0 ? '–¢—ã –ø–æ—Ç–µ—Ä—è–ª –∑–¥–æ—Ä–æ–≤—å–µ.' 
                    : happiness<=0 ? '–¢—ã –ø–æ—Ç–µ—Ä—è–ª —Å—á–∞—Å—Ç—å–µ.' 
                    : '–•–æ–¥—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å.';
        finishGame(reason);}
    };

    function updateBars(){
    document.getElementById('healthBar').style.width    = `${health}%`;
    document.getElementById('happinessBar').style.width = `${happiness}%`;
    }

    function updateHistory(event, free){
      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="p-2">${turn}</td>
        <td class="p-2">${event}</td>
        <td class="p-2">$${Math.round(free)}</td>
        <td class="p-2">$${Math.round(savings)}</td>
        <td class="p-2">$${Math.round(investments)}</td>
        <td class="p-2">${health}%</td>
        <td class="p-2">${happiness}%</td>`;
      document.getElementById('historyTable').appendChild(row);
    }

    function updateChart(){
      let score = Math.floor(savings/1000) + Math.floor(investments/1000)*2;
      if(health>70) score+=20;
      if(happiness>70) score+=20;
      const passive=(investments*0.05 + savings*0.03)/12;
      if(passive>1000) score+=30;
      scores.push(score);
      chart.data.labels.push(turn);
      chart.data.datasets[0].data.push(score);
      chart.update();
    }

    function finishGame(reason){
      document.getElementById('game-screen').classList.add('hidden');
      const end = document.getElementById('end-screen');
      end.classList.remove('hidden');
      document.getElementById('endReason').innerText = reason;
      document.getElementById('finalSavings').innerText = `$${Math.round(savings)}`;
      document.getElementById('finalInvestments').innerText = `$${Math.round(investments)}`;
      document.getElementById('finalHealth').innerText = `${health}%`;
      document.getElementById('finalHappiness').innerText = `${happiness}%`;
      document.getElementById('finalPassiveIncome').innerText = `$${Math.round((investments*0.05+savings*0.03)/12)}`;
      const finalScore = scores[scores.length-1];
      document.getElementById('finalScore').innerText = `${finalScore} –±–∞–ª–ª–æ–≤`;
      let title = '–ù–æ–≤–∏—á–æ–∫';
      if(finalScore>=80) title='–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –º–∞–≥–Ω–∞—Ç';
      else if(health>90) title='–ó–¥–æ—Ä–æ–≤—è–∫';
      else if(happiness>90) title='–°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫';
      else if(health<30) title='–í—ã–∂–∏–≤—à–∏–π';
      document.getElementById('finalTitle').innerText = title;
    }
  });
  </script>
</body>
</html>
